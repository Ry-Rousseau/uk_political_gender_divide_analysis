<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Future Data Waves Processing Demo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="demo_future_wave_processing_final_files/libs/clipboard/clipboard.min.js"></script>
<script src="demo_future_wave_processing_final_files/libs/quarto-html/quarto.js"></script>
<script src="demo_future_wave_processing_final_files/libs/quarto-html/popper.min.js"></script>
<script src="demo_future_wave_processing_final_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="demo_future_wave_processing_final_files/libs/quarto-html/anchor.min.js"></script>
<link href="demo_future_wave_processing_final_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="demo_future_wave_processing_final_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="demo_future_wave_processing_final_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="demo_future_wave_processing_final_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="demo_future_wave_processing_final_files/libs/bootstrap/bootstrap-1bc8a17f135ab3d594c857e9f48e611b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Future Data Waves Processing Demo</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p>Created all mock data waves in data/mock_waves using scripts/stratified_data_splitter.R.</p>
<p>These waves maintain national representativeness by balancing demographic splits from the original stratification methodology, and are realistic survey waves, however since they are all sampled from the provided data, they all show near-identical trends/effects.</p>
<p>The below visualizations can all be combined into an automated script but are separated here for clarity.</p>
<p>We’ll firstly load the survey waves and packages using a demo setup script. I’ll assume that 1) mock_waves includes only survey waves in sav format 2) files have standard naming conventions for files (“wave_1.sav”) and variables 3) waves carried out in discrete calendar months</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"scripts/functions.R"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"scripts/setup_demo.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "wave_1" "wave_2" "wave_3" "wave_4"
[1] "Demo setup complete. Data waves loaded and ready for processing."</code></pre>
</div>
</div>
<p>Now we can process each wave in turn, creating our variables for our existing analysis pipeline.</p>
<p>I’ll be displaying the larger, more involved functions in this notebook, but smaller functions are in scripts/functions.R.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>clean_data_and_create_ideology_scales <span class="ot">&lt;-</span> <span class="cf">function</span>(wave_data, wave_name){</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  cleaned_data <span class="ot">&lt;-</span> wave_data <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>survey_date, <span class="sc">~</span><span class="fu">case_when</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    .x <span class="sc">==</span> <span class="st">"Don't know"</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    .x <span class="sc">==</span> <span class="st">"dk"</span> <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    .x <span class="sc">==</span> <span class="st">"no_answer"</span> <span class="sc">~</span> <span class="cn">NA</span>,           <span class="co"># religion column</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    .x <span class="sc">==</span> <span class="st">"prefer_not_to_say"</span> <span class="sc">~</span> <span class="cn">NA</span>,   <span class="co"># marital column</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> .x</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  ))) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create gender age variable for analysis - removing NA's</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender_age =</span> <span class="fu">str_c</span>(gender,age , <span class="at">sep =</span> <span class="st">"_"</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert attitude variables to numeric and create scales</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert social attitude variables to numeric (-1 to 1 scale)</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_respect =</span> <span class="fu">recode_attitude_0_to_1</span>(soc_respect),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_deathpen =</span> <span class="fu">recode_attitude_0_to_1</span>(soc_deathpen),</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_schools =</span> <span class="fu">recode_attitude_0_to_1</span>(soc_schools),</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_censor =</span> <span class="fu">recode_attitude_0_to_1</span>(soc_censor),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_punish =</span> <span class="fu">recode_attitude_0_to_1</span>(soc_punish),</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert economic attitude variables to numeric (-1 to 1 scale)</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_redist =</span> <span class="fu">recode_attitude_0_to_1</span>(econ_redist),</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_bigbiz =</span> <span class="fu">recode_attitude_0_to_1</span>(econ_bigbiz),</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_unfair =</span> <span class="fu">recode_attitude_0_to_1</span>(econ_unfair),</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_onelaw =</span> <span class="fu">recode_attitude_0_to_1</span>(econ_onelaw),</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_exploit =</span> <span class="fu">recode_attitude_0_to_1</span>(econ_exploit)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">social_conservatism =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(<span class="fu">c</span>(soc_respect, soc_deathpen, soc_schools, soc_censor, soc_punish)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">economic_rightism =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(<span class="fu">c</span>(econ_redist, econ_bigbiz, econ_unfair, econ_onelaw, econ_exploit)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">social_na_count =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(<span class="fu">c_across</span>(<span class="fu">c</span>(soc_respect, soc_deathpen, soc_schools, soc_censor, soc_punish)))),</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">economic_na_count =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(<span class="fu">c_across</span>(<span class="fu">c</span>(econ_redist, econ_bigbiz, econ_unfair, econ_onelaw, econ_exploit))))</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert survey items back to [-1, -0.5, 0, 0.5, 1] scale for easier interpretation along intuitive agree-disagree continuum</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_respect =</span> soc_respect <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_deathpen =</span> soc_deathpen <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_schools =</span> soc_schools <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_censor =</span> soc_censor <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">soc_punish =</span> soc_punish <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_redist =</span> econ_redist <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_bigbiz =</span> econ_bigbiz <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_unfair =</span> econ_unfair <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_onelaw =</span> econ_onelaw <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">econ_exploit =</span> econ_exploit <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add month, year, wave column</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_year =</span> <span class="fu">year</span>(survey_date), </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">month</span>(survey_date), <span class="co"># numeric month</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_name =</span> <span class="fu">month</span>(survey_date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">TRUE</span>), <span class="co"># Jan, Feb etc.</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(cleaned_data)</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Process each wave</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>processed_waves <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(data_waves), <span class="cf">function</span>(wave_name) {</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  wave_data <span class="ot">&lt;-</span> data_waves[[wave_name]]</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_data_and_create_ideology_scales</span>(wave_data, wave_name)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Create combined data</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(processed_waves)</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine a wave to verify processing</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(processed_waves[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4,927
Columns: 38
$ respondent_id       &lt;chr&gt; "fd6600884414", "fd9019719581", "fd2937221765", "f…
$ wt                  &lt;dbl&gt; 1.041400, 1.041400, 1.041400, 1.041400, 1.041400, …
$ age                 &lt;chr&gt; "25_TO_34", "25_TO_34", "25_TO_34", "25_TO_34", "2…
$ gender              &lt;chr&gt; "male", "male", "male", "male", "male", "male", "m…
$ education           &lt;chr&gt; "low", "low", "low", "low", "low", "low", "low", "…
$ ethnicity           &lt;chr&gt; "white", "white", "white", "white", "white", "whit…
$ region              &lt;chr&gt; "East of England", "East of England", "East of Eng…
$ cons_code           &lt;chr&gt; "E14001502", "E14001425", "E14001425", "E14001302"…
$ cons_name           &lt;chr&gt; "Southend West &amp; Leigh", "Peterborough", "Peterbor…
$ household           &lt;chr&gt; "owns_with_mortgage_or_shared", "social_rented", "…
$ religion            &lt;chr&gt; "christian", "christian", "christian", "none", "no…
$ socgrad             &lt;chr&gt; "C2", "DE", "AB", "AB", "C1", "C2", "C1", "DE", "C…
$ marital             &lt;chr&gt; "relationship_living", "single", "married_civil", …
$ pv_2019             &lt;chr&gt; "con", "dnv", "lab", "lab", "con", "lab", "con", "…
$ pv_2024             &lt;chr&gt; "con", "con", "lab", "lab", "lab", "lab", "rfm", "…
$ eu_ref              &lt;chr&gt; "leave", "dnv", "remain", "leave", "leave", "remai…
$ exact_age           &lt;dbl&gt; 34, 31, 29, 34, 29, 33, 30, 32, 33, 32, 34, 32, 32…
$ econ_redist         &lt;dbl&gt; 0.5, 0.0, 0.0, 0.5, 0.5, 1.0, 0.5, 1.0, 0.5, 0.5, …
$ econ_bigbiz         &lt;dbl&gt; -1.0, 1.0, 0.5, 1.0, 1.0, 0.5, 1.0, NA, 1.0, 0.5, …
$ econ_unfair         &lt;dbl&gt; 0.5, 1.0, 1.0, 1.0, 0.5, 0.5, 0.5, 1.0, 0.5, 0.5, …
$ econ_onelaw         &lt;dbl&gt; 1.0, 0.5, 1.0, 1.0, 1.0, 0.5, 0.0, 1.0, 1.0, 1.0, …
$ econ_exploit        &lt;dbl&gt; 0.5, 0.0, -1.0, 1.0, 1.0, 0.5, 0.5, 0.0, 1.0, 1.0,…
$ soc_respect         &lt;dbl&gt; 1.0, 0.5, 0.5, -0.5, 0.5, 0.0, 0.5, 1.0, 1.0, 0.5,…
$ soc_deathpen        &lt;dbl&gt; 1.0, 0.0, 0.5, 0.5, 1.0, 0.0, 0.0, 0.0, 1.0, 1.0, …
$ soc_schools         &lt;dbl&gt; 0.5, 0.0, -0.5, 0.5, 0.5, -0.5, 1.0, 1.0, 0.5, 1.0…
$ soc_censor          &lt;dbl&gt; -0.5, 0.5, 0.0, -1.0, 0.0, 0.0, NA, 0.5, -0.5, 1.0…
$ soc_punish          &lt;dbl&gt; 0.5, 0.0, 0.0, 0.5, 0.5, 1.0, 0.5, 0.0, 0.5, 0.5, …
$ survey_wave         &lt;chr&gt; "May_2024", "May_2024", "May_2024", "May_2024", "M…
$ wave_number         &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ survey_date         &lt;date&gt; 2024-05-14, 2024-05-25, 2024-05-10, 2024-05-09, 2…
$ gender_age          &lt;chr&gt; "male_25_TO_34_TRUE", "male_25_TO_34_TRUE", "male_…
$ social_conservatism &lt;dbl&gt; 0.75, 0.60, 0.55, 0.50, 0.75, 0.55, 0.75, 0.75, 0.…
$ economic_rightism   &lt;dbl&gt; 0.350, 0.250, 0.350, 0.050, 0.100, 0.200, 0.250, 0…
$ social_na_count     &lt;int&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5,…
$ economic_na_count   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 4,…
$ month_year          &lt;dbl&gt; 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 20…
$ month               &lt;dbl&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5,…
$ month_name          &lt;ord&gt; May, May, May, May, May, May, May, May, May, May, …</code></pre>
</div>
</div>
<p>Create a battery of visuals that track ideological trends over time. These will follow on from the visualizations in the main analysis pipeline.</p>
<section id="gender-gap-trends-by-age-group-over-time" class="level4">
<h4 class="anchored" data-anchor-id="gender-gap-trends-by-age-group-over-time">Gender Gap Trends by Age Group Over Time</h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over all the processed waves and survey design objects</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>calculate_gender_gap_no_age <span class="ot">&lt;-</span> <span class="cf">function</span>(processed_waves) {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  mean_gap_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (wave <span class="cf">in</span> processed_waves) {</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    wave <span class="ot">=</span> processed_waves[[<span class="dv">1</span>]]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    survey_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> wave, <span class="at">weights =</span> <span class="sc">~</span>wt)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate survey-weighted means by age and gender - conservatism</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    social_conservatism_means <span class="ot">&lt;-</span> <span class="fu">svyby</span>(</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>social_conservatism,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span>age <span class="sc">+</span> gender,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">design =</span> survey_design,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> svymean,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">social_conservatism_mean =</span> social_conservatism)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate survey-weighted means by age and gender - economic rightism</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    economic_rightism_means <span class="ot">&lt;-</span> <span class="fu">svyby</span>(</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>economic_rightism,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>age <span class="sc">+</span> gender,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">design =</span> survey_design,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> svymean,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">economic_rightism_mean =</span> economic_rightism)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Merge together</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    means_conservatism_rightism <span class="ot">&lt;-</span> economic_rightism_means <span class="sc">%&gt;%</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(social_conservatism_means, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"gender"</span>), <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_econ"</span>, <span class="st">"_soc"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add wave identifier</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">wave =</span> i)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># save to list</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    mean_gap_results[[i]] <span class="ot">&lt;-</span> means_conservatism_rightism</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># increment wave counter</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bind rows from list</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mean_gap_results)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(combined)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>gender_gaps_no_age <span class="ot">&lt;-</span> <span class="fu">calculate_gender_gap_no_age</span>(processed_waves)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(gender_gaps_no_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        age gender economic_rightism_mean     se_econ social_conservatism_mean
1  18_TO_24 female              0.2608834 0.010037890                0.5864472
2  25_TO_34 female              0.2762965 0.007455720                0.6486358
3  35_TO_44 female              0.2695582 0.007727466                0.6465142
4  45_TO_54 female              0.2921879 0.008679694                0.6714463
5  55_TO_64 female              0.2991861 0.009898287                0.6971133
6  65_TO_74 female              0.3566039 0.012203887                0.7127750
7   75_PLUS female              0.4244186 0.019452105                0.7476749
8  18_TO_24   male              0.3083262 0.014020581                0.6263098
9  25_TO_34   male              0.2989086 0.009291028                0.6417386
10 35_TO_44   male              0.2728858 0.009514956                0.6610395
11 45_TO_54   male              0.2733629 0.010253625                0.6560812
12 55_TO_64   male              0.2705549 0.011792967                0.6691272
13 65_TO_74   male              0.3125678 0.013935000                0.6983925
14  75_PLUS   male              0.3956938 0.023799719                0.7296607
15 18_TO_24 female              0.2608834 0.010037890                0.5864472
16 25_TO_34 female              0.2762965 0.007455720                0.6486358
17 35_TO_44 female              0.2695582 0.007727466                0.6465142
18 45_TO_54 female              0.2921879 0.008679694                0.6714463
19 55_TO_64 female              0.2991861 0.009898287                0.6971133
20 65_TO_74 female              0.3566039 0.012203887                0.7127750
21  75_PLUS female              0.4244186 0.019452105                0.7476749
22 18_TO_24   male              0.3083262 0.014020581                0.6263098
23 25_TO_34   male              0.2989086 0.009291028                0.6417386
24 35_TO_44   male              0.2728858 0.009514956                0.6610395
25 45_TO_54   male              0.2733629 0.010253625                0.6560812
26 55_TO_64   male              0.2705549 0.011792967                0.6691272
27 65_TO_74   male              0.3125678 0.013935000                0.6983925
28  75_PLUS   male              0.3956938 0.023799719                0.7296607
29 18_TO_24 female              0.2608834 0.010037890                0.5864472
30 25_TO_34 female              0.2762965 0.007455720                0.6486358
31 35_TO_44 female              0.2695582 0.007727466                0.6465142
32 45_TO_54 female              0.2921879 0.008679694                0.6714463
33 55_TO_64 female              0.2991861 0.009898287                0.6971133
34 65_TO_74 female              0.3566039 0.012203887                0.7127750
35  75_PLUS female              0.4244186 0.019452105                0.7476749
36 18_TO_24   male              0.3083262 0.014020581                0.6263098
37 25_TO_34   male              0.2989086 0.009291028                0.6417386
38 35_TO_44   male              0.2728858 0.009514956                0.6610395
39 45_TO_54   male              0.2733629 0.010253625                0.6560812
40 55_TO_64   male              0.2705549 0.011792967                0.6691272
41 65_TO_74   male              0.3125678 0.013935000                0.6983925
42  75_PLUS   male              0.3956938 0.023799719                0.7296607
43 18_TO_24 female              0.2608834 0.010037890                0.5864472
44 25_TO_34 female              0.2762965 0.007455720                0.6486358
45 35_TO_44 female              0.2695582 0.007727466                0.6465142
46 45_TO_54 female              0.2921879 0.008679694                0.6714463
47 55_TO_64 female              0.2991861 0.009898287                0.6971133
48 65_TO_74 female              0.3566039 0.012203887                0.7127750
49  75_PLUS female              0.4244186 0.019452105                0.7476749
50 18_TO_24   male              0.3083262 0.014020581                0.6263098
51 25_TO_34   male              0.2989086 0.009291028                0.6417386
52 35_TO_44   male              0.2728858 0.009514956                0.6610395
53 45_TO_54   male              0.2733629 0.010253625                0.6560812
54 55_TO_64   male              0.2705549 0.011792967                0.6691272
55 65_TO_74   male              0.3125678 0.013935000                0.6983925
56  75_PLUS   male              0.3956938 0.023799719                0.7296607
        se_soc wave
1  0.010720341    1
2  0.008718745    1
3  0.009080675    1
4  0.008518615    1
5  0.009887055    1
6  0.010587833    1
7  0.016465477    1
8  0.013829855    1
9  0.010499036    1
10 0.010758013    1
11 0.010808447    1
12 0.011757782    1
13 0.011519108    1
14 0.017509892    1
15 0.010720341    2
16 0.008718745    2
17 0.009080675    2
18 0.008518615    2
19 0.009887055    2
20 0.010587833    2
21 0.016465477    2
22 0.013829855    2
23 0.010499036    2
24 0.010758013    2
25 0.010808447    2
26 0.011757782    2
27 0.011519108    2
28 0.017509892    2
29 0.010720341    3
30 0.008718745    3
31 0.009080675    3
32 0.008518615    3
33 0.009887055    3
34 0.010587833    3
35 0.016465477    3
36 0.013829855    3
37 0.010499036    3
38 0.010758013    3
39 0.010808447    3
40 0.011757782    3
41 0.011519108    3
42 0.017509892    3
43 0.010720341    4
44 0.008718745    4
45 0.009080675    4
46 0.008518615    4
47 0.009887055    4
48 0.010587833    4
49 0.016465477    4
50 0.013829855    4
51 0.010499036    4
52 0.010758013    4
53 0.010808447    4
54 0.011757782    4
55 0.011519108    4
56 0.017509892    4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate visualizations for the waves</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization for gender gaps by age across waves</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>create_gender_scores_by_wave <span class="ot">&lt;-</span> <span class="cf">function</span>(gender_gaps_data) {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set up colors and styling consistent with project theme</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  gender_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">female =</span> <span class="st">"#E76F51"</span>, <span class="at">male =</span> <span class="st">"#2A9D8F"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create age group labels for better readability</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  age_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"18_TO_24"</span> <span class="ot">=</span> <span class="st">"18-24"</span>, <span class="st">"25_TO_34"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, <span class="st">"35_TO_44"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"45_TO_54"</span> <span class="ot">=</span> <span class="st">"45-54"</span>, <span class="st">"55_TO_64"</span> <span class="ot">=</span> <span class="st">"55-64"</span>, <span class="st">"65_TO_74"</span> <span class="ot">=</span> <span class="st">"65-74"</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"75_PLUS"</span> <span class="ot">=</span> <span class="st">"75+"</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Social conservatism plot</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  social_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gender_gaps_data, </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> wave, <span class="at">y =</span> social_conservatism_mean, </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">color =</span> gender, <span class="at">group =</span> <span class="fu">interaction</span>(age, gender))) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> social_conservatism_mean <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se_soc,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymax =</span> social_conservatism_mean <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se_soc),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>age, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">age =</span> age_labels), <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> gender_colors, <span class="at">name =</span> <span class="st">"Gender"</span>) <span class="sc">+</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(gender_gaps_data<span class="sc">$</span>wave)),</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, <span class="fu">sort</span>(<span class="fu">unique</span>(gender_gaps_data<span class="sc">$</span>wave)))) <span class="sc">+</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Social Conservatism by Gender and Age Across Waves"</span>,</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Survey Wave"</span>, </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Mean Social Conservatism Score"</span>,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">"Error bars show 95% confidence intervals"</span>) <span class="sc">+</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Economic rightism plot  </span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>  economic_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(gender_gaps_data, </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> wave, <span class="at">y =</span> economic_rightism_mean, </span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>                             <span class="at">color =</span> gender, <span class="at">group =</span> <span class="fu">interaction</span>(age, gender))) <span class="sc">+</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> economic_rightism_mean <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>se_econ,</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymax =</span> economic_rightism_mean <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>se_econ),</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>age, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">age =</span> age_labels), <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> gender_colors, <span class="at">name =</span> <span class="st">"Gender"</span>) <span class="sc">+</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(gender_gaps_data<span class="sc">$</span>wave)),</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, <span class="fu">sort</span>(<span class="fu">unique</span>(gender_gaps_data<span class="sc">$</span>wave)))) <span class="sc">+</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Economic Rightism by Gender and Age Across Waves"</span>,</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Survey Wave"</span>, </span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Mean Economic Rightism Score"</span>,</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">"Error bars show 95% confidence intervals"</span>) <span class="sc">+</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">social =</span> social_plot, <span class="at">economic =</span> economic_plot))</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate and display the plots</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>wave_plots <span class="ot">&lt;-</span> <span class="fu">create_gender_scores_by_wave</span>(gender_gaps_no_age)</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Display social conservatism trends</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>wave_plots<span class="sc">$</span>social</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display economic rightism trends  </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>wave_plots<span class="sc">$</span>economic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gender-gap-trends-by-age-group-over-time-1" class="level4">
<h4 class="anchored" data-anchor-id="gender-gap-trends-by-age-group-over-time-1">Gender Gap Trends by Age Group Over Time</h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate gender gaps (male - female) for each age group across waves</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>calculate_gender_gaps_by_age <span class="ot">&lt;-</span> <span class="cf">function</span>(gender_gaps_data) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate gaps for each ideology measure</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  gap_data <span class="ot">&lt;-</span> gender_gaps_data <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(wave, age, gender, social_conservatism_mean, economic_rightism_mean, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>           se_soc, se_econ) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> gender, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">values_from =</span> <span class="fu">c</span>(social_conservatism_mean, economic_rightism_mean, se_soc, se_econ),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate gender gaps (male - female)</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">social_gap =</span> social_conservatism_mean_male <span class="sc">-</span> social_conservatism_mean_female,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">economic_gap =</span> economic_rightism_mean_male <span class="sc">-</span> economic_rightism_mean_female,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate combined standard errors for gaps</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">social_gap_se =</span> <span class="fu">sqrt</span>(se_soc_male<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> se_soc_female<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">economic_gap_se =</span> <span class="fu">sqrt</span>(se_econ_male<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> se_econ_female<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(wave, age, social_gap, economic_gap, social_gap_se, economic_gap_se)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(gap_data)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization for gender gaps across waves</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>create_gender_gap_trends <span class="ot">&lt;-</span> <span class="cf">function</span>(gap_data) {</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set up colors for age groups (similar to existing approach)</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  age_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#E76F51"</span>, <span class="st">"#F4A261"</span>, <span class="st">"#E9C46A"</span>, <span class="st">"#2A9D8F"</span>, <span class="st">"#264653"</span>, <span class="st">"#1D3557"</span>, <span class="st">"#8B4B8C"</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(age_colors) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"18_TO_24"</span>, <span class="st">"25_TO_34"</span>, <span class="st">"35_TO_44"</span>, <span class="st">"45_TO_54"</span>, <span class="st">"55_TO_64"</span>, <span class="st">"65_TO_74"</span>, <span class="st">"75_PLUS"</span>)</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create age group labels for better readability</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  age_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"18_TO_24"</span> <span class="ot">=</span> <span class="st">"18-24"</span>, <span class="st">"25_TO_34"</span> <span class="ot">=</span> <span class="st">"25-34"</span>, <span class="st">"35_TO_44"</span> <span class="ot">=</span> <span class="st">"35-44"</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"45_TO_54"</span> <span class="ot">=</span> <span class="st">"45-54"</span>, <span class="st">"55_TO_64"</span> <span class="ot">=</span> <span class="st">"55-64"</span>, <span class="st">"65_TO_74"</span> <span class="ot">=</span> <span class="st">"65-74"</span>, </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"75_PLUS"</span> <span class="ot">=</span> <span class="st">"75+"</span>)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare data for plotting</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  plot_data <span class="ot">&lt;-</span> gap_data <span class="sc">%&gt;%</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age_label =</span> age_labels[age])</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Social conservatism gap plot</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  social_gap_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> wave, <span class="at">y =</span> social_gap, <span class="at">color =</span> age, <span class="at">group =</span> age)) <span class="sc">+</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> social_gap <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>social_gap_se, </span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymax =</span> social_gap <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>social_gap_se),</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>                 <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> age_colors, <span class="at">name =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> age_labels) <span class="sc">+</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(plot_data<span class="sc">$</span>wave)),</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, <span class="fu">sort</span>(<span class="fu">unique</span>(plot_data<span class="sc">$</span>wave)))) <span class="sc">+</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Social Conservatism Gender Gap by Age Across Waves"</span>,</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Positive values indicate men more socially conservative than women"</span>,</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Survey Wave"</span>, </span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Gender Gap (Male - Female)"</span>,</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">"Error bars show 95% confidence intervals"</span>) <span class="sc">+</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">"grey40"</span>),</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Economic rightism gap plot  </span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>  economic_gap_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> wave, <span class="at">y =</span> economic_gap, <span class="at">color =</span> age, <span class="at">group =</span> age)) <span class="sc">+</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> economic_gap <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>economic_gap_se, </span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymax =</span> economic_gap <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>economic_gap_se),</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>                 <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> age_colors, <span class="at">name =</span> <span class="st">"Age Group"</span>,</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> age_labels) <span class="sc">+</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(plot_data<span class="sc">$</span>wave)),</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, <span class="fu">sort</span>(<span class="fu">unique</span>(plot_data<span class="sc">$</span>wave)))) <span class="sc">+</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Economic Rightism Gender Gap by Age Across Waves"</span>,</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Positive values indicate men more economically right-wing than women"</span>,</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Survey Wave"</span>, </span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Gender Gap (Male - Female)"</span>,</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">"Error bars show 95% confidence intervals"</span>) <span class="sc">+</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">"grey40"</span>),</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">social =</span> social_gap_plot, <span class="at">economic =</span> economic_gap_plot))</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate gender gaps by age</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>gender_gaps_by_age <span class="ot">&lt;-</span> <span class="fu">calculate_gender_gaps_by_age</span>(gender_gaps_no_age)</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate gap trend plots</span></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>gap_trend_plots <span class="ot">&lt;-</span> <span class="fu">create_gender_gap_trends</span>(gender_gaps_by_age)</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Display social conservatism gender gap trends</span></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>gap_trend_plots<span class="sc">$</span>social</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display economic rightism gender gap trends</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>gap_trend_plots<span class="sc">$</span>economic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="model-examiniation-of-key-demographic-effects" class="level4">
<h4 class="anchored" data-anchor-id="model-examiniation-of-key-demographic-effects">Model examiniation of key demographic effects</h4>
<p>This framework can be used to signal shifts in the effects of key demographic predictors over time. Signals unique effects observed in the previous survey waves that should be examined further as possible early-signs of growing trends around changing attitudinal patterns.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models for all waves combined</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>fit_models_for_each_wave <span class="ot">&lt;-</span> <span class="cf">function</span>(processed_waves) {</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  model_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (wave <span class="cf">in</span> processed_waves){</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    survey_design_full <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span>wt,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> wave</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    model_social <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  social_conservatism <span class="sc">~</span> gender <span class="sc">*</span> age <span class="sc">+</span> gender <span class="sc">*</span> education <span class="sc">+</span> age <span class="sc">*</span> education <span class="sc">+</span> </span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                       gender <span class="sc">*</span> region <span class="sc">+</span> ethnicity <span class="sc">+</span> household <span class="sc">+</span> socgrad <span class="sc">+</span> </span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                       marital <span class="sc">+</span> religion,</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> survey_design_full,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  model_economic <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  economic_rightism <span class="sc">~</span> gender <span class="sc">*</span> age <span class="sc">+</span> gender <span class="sc">*</span> education <span class="sc">+</span> age <span class="sc">*</span> education <span class="sc">+</span> </span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>                       gender <span class="sc">*</span> region <span class="sc">+</span> ethnicity <span class="sc">+</span> household <span class="sc">+</span> socgrad <span class="sc">+</span> </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>                       marital <span class="sc">+</span> religion,</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> survey_design_full,</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>()</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>)  </span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  model_results[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">social =</span> model_social, <span class="at">economic =</span> model_economic)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(model_results)</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Model results for all previous waves except last</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>all_waves_minus_last <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(processed_waves[<span class="sc">-</span><span class="fu">length</span>(processed_waves)])</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>survey_design_full <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, </span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> <span class="sc">~</span>wt,</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> all_waves_minus_last</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>model_social <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  social_conservatism <span class="sc">~</span> gender <span class="sc">*</span> age <span class="sc">+</span> gender <span class="sc">*</span> education <span class="sc">+</span> age <span class="sc">*</span> education <span class="sc">+</span> </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>                       gender <span class="sc">*</span> region <span class="sc">+</span> ethnicity <span class="sc">+</span> household <span class="sc">+</span> socgrad <span class="sc">+</span> </span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>                       marital <span class="sc">+</span> religion,</span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> survey_design_full,</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>())</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>model_economic <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  economic_rightism <span class="sc">~</span> gender <span class="sc">*</span> age <span class="sc">+</span> gender <span class="sc">*</span> education <span class="sc">+</span> age <span class="sc">*</span> education <span class="sc">+</span> </span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>                       gender <span class="sc">*</span> region <span class="sc">+</span> ethnicity <span class="sc">+</span> household <span class="sc">+</span> socgrad <span class="sc">+</span> </span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>                       marital <span class="sc">+</span> religion,</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">design =</span> survey_design_full,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">gaussian</span>())  </span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="do">### Models results for all waves including last</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>all_survey_wave_models <span class="ot">&lt;-</span> <span class="fu">fit_models_for_each_wave</span>(processed_waves)</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(all_survey_wave_models[[1]][[1]])  # Social model for wave 1</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract key coefficients with confidence intervals</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>extract_key_coefficients <span class="ot">&lt;-</span> <span class="cf">function</span>(model, model_name, outcome_type) {</span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get model summary with confidence intervals</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>  coef_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>coefficients</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>  confint_results <span class="ot">&lt;-</span> <span class="fu">confint</span>(model)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Key theoretically significant coefficients based on your model structure</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>  key_coeffs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gendermale"</span>,                           <span class="co"># Main gender effect</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age25_TO_34"</span>,                          <span class="co"># Key young age groups</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">"age35_TO_44"</span>, </span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gendermale:age25_TO_34"</span>,              <span class="co"># Gender-age interactions (core to the research)</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gendermale:age35_TO_44"</span>,</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gendermale:age45_TO_54"</span>,</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gendermale:age55_TO_64"</span>,</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gendermale:educationlow"</span>,             <span class="co"># Gender-education interaction</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gendermale:regionGreater London"</span>,     <span class="co"># Gender-region interactions (urban effects)</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gendermale:regionScotland"</span>,</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gendermale:regionWest Midlands"</span>,</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>    <span class="st">"religionnone"</span>,                        <span class="co"># Key social attitude predictor</span></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ethnicitywhite"</span>,                      <span class="co"># Ethnicity effects</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ethnicitymixed"</span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter for available coefficients</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>  available_coeffs <span class="ot">&lt;-</span> <span class="fu">intersect</span>(key_coeffs, <span class="fu">rownames</span>(coef_summary))</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only proceed if we have coefficients</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(available_coeffs) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"No key coefficients found in model"</span>)</span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>())</span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract coefficient data</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>  coeff_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">coefficient =</span> available_coeffs,</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate =</span> coef_summary[available_coeffs, <span class="st">"Estimate"</span>],</span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>    <span class="at">std_error =</span> coef_summary[available_coeffs, <span class="st">"Std. Error"</span>],</span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_value =</span> coef_summary[available_coeffs, <span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> confint_results[available_coeffs, <span class="dv">1</span>],</span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> confint_results[available_coeffs, <span class="dv">2</span>],</span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> model_name,</span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> outcome_type,</span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(coeff_data)</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract coefficients for comparison models</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Latest wave models (highest index)</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>latest_wave_idx <span class="ot">&lt;-</span> <span class="fu">length</span>(all_survey_wave_models)</span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>latest_social_coeffs <span class="ot">&lt;-</span> <span class="fu">extract_key_coefficients</span>(</span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>  all_survey_wave_models[[latest_wave_idx]]<span class="sc">$</span>social, </span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Latest Wave"</span>, </span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Social Conservatism"</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>latest_economic_coeffs <span class="ot">&lt;-</span> <span class="fu">extract_key_coefficients</span>(</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>  all_survey_wave_models[[latest_wave_idx]]<span class="sc">$</span>economic, </span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Latest Wave"</span>, </span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Economic Rightism"</span></span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a><span class="co"># All previous waves models</span></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>all_previous_social_coeffs <span class="ot">&lt;-</span> <span class="fu">extract_key_coefficients</span>(</span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>  model_social, </span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>  <span class="st">"All Previous Waves"</span>, </span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Social Conservatism"</span></span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a>all_previous_economic_coeffs <span class="ot">&lt;-</span> <span class="fu">extract_key_coefficients</span>(</span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>  model_economic, </span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>  <span class="st">"All Previous Waves"</span>, </span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Economic Rightism"</span></span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all coefficient data</span></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>all_coeffs <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a>  latest_social_coeffs,</span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a>  latest_economic_coeffs,</span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a>  all_previous_social_coeffs,</span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a>  all_previous_economic_coeffs</span>
<span id="cb11-151"><a href="#cb11-151" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-152"><a href="#cb11-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-153"><a href="#cb11-153" aria-hidden="true" tabindex="-1"></a><span class="co"># Create coefficient labels for better readability</span></span>
<span id="cb11-154"><a href="#cb11-154" aria-hidden="true" tabindex="-1"></a>all_coeffs<span class="sc">$</span>coeff_label <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb11-155"><a href="#cb11-155" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"gendermale"</span> <span class="sc">~</span> <span class="st">"Male (vs Female)"</span>,</span>
<span id="cb11-156"><a href="#cb11-156" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"age25_TO_34"</span> <span class="sc">~</span> <span class="st">"Age 25-34"</span>,</span>
<span id="cb11-157"><a href="#cb11-157" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"age35_TO_44"</span> <span class="sc">~</span> <span class="st">"Age 35-44"</span>, </span>
<span id="cb11-158"><a href="#cb11-158" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"gendermale:age25_TO_34"</span> <span class="sc">~</span> <span class="st">"Male × Age 25-34"</span>,</span>
<span id="cb11-159"><a href="#cb11-159" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"gendermale:age35_TO_44"</span> <span class="sc">~</span> <span class="st">"Male × Age 35-44"</span>,</span>
<span id="cb11-160"><a href="#cb11-160" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"gendermale:age45_TO_54"</span> <span class="sc">~</span> <span class="st">"Male × Age 45-54"</span>,</span>
<span id="cb11-161"><a href="#cb11-161" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"gendermale:age55_TO_64"</span> <span class="sc">~</span> <span class="st">"Male × Age 55-64"</span>,</span>
<span id="cb11-162"><a href="#cb11-162" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"gendermale:educationlow"</span> <span class="sc">~</span> <span class="st">"Male × Lower Education"</span>,</span>
<span id="cb11-163"><a href="#cb11-163" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"gendermale:regionGreater London"</span> <span class="sc">~</span> <span class="st">"Male × London"</span>,</span>
<span id="cb11-164"><a href="#cb11-164" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"gendermale:regionScotland"</span> <span class="sc">~</span> <span class="st">"Male × Scotland"</span>,</span>
<span id="cb11-165"><a href="#cb11-165" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"gendermale:regionWest Midlands"</span> <span class="sc">~</span> <span class="st">"Male × West Midlands"</span>,</span>
<span id="cb11-166"><a href="#cb11-166" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"religionnone"</span> <span class="sc">~</span> <span class="st">"No Religion"</span>,</span>
<span id="cb11-167"><a href="#cb11-167" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"ethnicitywhite"</span> <span class="sc">~</span> <span class="st">"White Ethnicity"</span>,</span>
<span id="cb11-168"><a href="#cb11-168" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>coefficient <span class="sc">==</span> <span class="st">"ethnicitymixed"</span> <span class="sc">~</span> <span class="st">"Mixed Ethnicity"</span>,</span>
<span id="cb11-169"><a href="#cb11-169" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> all_coeffs<span class="sc">$</span>coefficient</span>
<span id="cb11-170"><a href="#cb11-170" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-171"><a href="#cb11-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-172"><a href="#cb11-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Add significance indicators</span></span>
<span id="cb11-173"><a href="#cb11-173" aria-hidden="true" tabindex="-1"></a>all_coeffs<span class="sc">$</span>significance <span class="ot">&lt;-</span> <span class="fu">case_when</span>(</span>
<span id="cb11-174"><a href="#cb11-174" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>p_value <span class="sc">&lt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"***"</span>,</span>
<span id="cb11-175"><a href="#cb11-175" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>p_value <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"**"</span>, </span>
<span id="cb11-176"><a href="#cb11-176" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>p_value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb11-177"><a href="#cb11-177" aria-hidden="true" tabindex="-1"></a>  all_coeffs<span class="sc">$</span>p_value <span class="sc">&lt;</span> <span class="fl">0.1</span> <span class="sc">~</span> <span class="st">"."</span>,</span>
<span id="cb11-178"><a href="#cb11-178" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb11-179"><a href="#cb11-179" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-180"><a href="#cb11-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-181"><a href="#cb11-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the forest plot function</span></span>
<span id="cb11-182"><a href="#cb11-182" aria-hidden="true" tabindex="-1"></a>create_forest_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(outcome_filter) {</span>
<span id="cb11-183"><a href="#cb11-183" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-184"><a href="#cb11-184" aria-hidden="true" tabindex="-1"></a>  plot_data <span class="ot">&lt;-</span> all_coeffs <span class="sc">%&gt;%</span></span>
<span id="cb11-185"><a href="#cb11-185" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(outcome <span class="sc">==</span> outcome_filter) <span class="sc">%&gt;%</span></span>
<span id="cb11-186"><a href="#cb11-186" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-187"><a href="#cb11-187" aria-hidden="true" tabindex="-1"></a>      <span class="at">model_outcome =</span> <span class="fu">paste</span>(model, outcome, <span class="at">sep =</span> <span class="st">" - "</span>),</span>
<span id="cb11-188"><a href="#cb11-188" aria-hidden="true" tabindex="-1"></a>      <span class="at">coeff_label =</span> <span class="fu">factor</span>(coeff_label, <span class="at">levels =</span> <span class="fu">rev</span>(<span class="fu">unique</span>(coeff_label)))</span>
<span id="cb11-189"><a href="#cb11-189" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-190"><a href="#cb11-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-191"><a href="#cb11-191" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(plot_data) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb11-192"><a href="#cb11-192" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"No data available for"</span>, outcome_filter))</span>
<span id="cb11-193"><a href="#cb11-193" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"No data for"</span>, outcome_filter)))</span>
<span id="cb11-194"><a href="#cb11-194" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-195"><a href="#cb11-195" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-196"><a href="#cb11-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> coeff_label, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb11-197"><a href="#cb11-197" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb11-198"><a href="#cb11-198" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ci_lower, <span class="at">xmax =</span> ci_upper), </span>
<span id="cb11-199"><a href="#cb11-199" aria-hidden="true" tabindex="-1"></a>                   <span class="at">height =</span> <span class="fl">0.3</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb11-200"><a href="#cb11-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb11-201"><a href="#cb11-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> significance), </span>
<span id="cb11-202"><a href="#cb11-202" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>),</span>
<span id="cb11-203"><a href="#cb11-203" aria-hidden="true" tabindex="-1"></a>              <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb11-204"><a href="#cb11-204" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Latest Wave"</span> <span class="ot">=</span> <span class="st">"#e31a1c"</span>, </span>
<span id="cb11-205"><a href="#cb11-205" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"All Previous Waves"</span> <span class="ot">=</span> <span class="st">"#1f78b4"</span>)) <span class="sc">+</span></span>
<span id="cb11-206"><a href="#cb11-206" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb11-207"><a href="#cb11-207" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Key Coefficients Comparison:"</span>, outcome_filter),</span>
<span id="cb11-208"><a href="#cb11-208" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Latest Wave vs All Previous Waves Models"</span>,</span>
<span id="cb11-209"><a href="#cb11-209" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Coefficient Estimate (95% CI)"</span>,</span>
<span id="cb11-210"><a href="#cb11-210" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Model Terms"</span>,</span>
<span id="cb11-211"><a href="#cb11-211" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Model"</span>,</span>
<span id="cb11-212"><a href="#cb11-212" aria-hidden="true" tabindex="-1"></a>      <span class="co">#caption = "Significance: *** p&lt;0.001, ** p&lt;0.01, * p&lt;0.05, . p&lt;0.1\nPositive values indicate more conservative/rightist attitudes"</span></span>
<span id="cb11-213"><a href="#cb11-213" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-214"><a href="#cb11-214" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-215"><a href="#cb11-215" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-216"><a href="#cb11-216" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb11-217"><a href="#cb11-217" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb11-218"><a href="#cb11-218" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb11-219"><a href="#cb11-219" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb11-220"><a href="#cb11-220" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb11-221"><a href="#cb11-221" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb11-222"><a href="#cb11-222" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-223"><a href="#cb11-223" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>, <span class="at">size =</span> <span class="fl">0.5</span>),</span>
<span id="cb11-224"><a href="#cb11-224" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">"gray60"</span>)</span>
<span id="cb11-225"><a href="#cb11-225" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-226"><a href="#cb11-226" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">4</span>)))</span>
<span id="cb11-227"><a href="#cb11-227" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-228"><a href="#cb11-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-229"><a href="#cb11-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Create forest plots for both outcomes</span></span>
<span id="cb11-230"><a href="#cb11-230" aria-hidden="true" tabindex="-1"></a>social_forest_plot <span class="ot">&lt;-</span> <span class="fu">create_forest_plot</span>(<span class="st">"Social Conservatism"</span>)</span>
<span id="cb11-231"><a href="#cb11-231" aria-hidden="true" tabindex="-1"></a>economic_forest_plot <span class="ot">&lt;-</span> <span class="fu">create_forest_plot</span>(<span class="st">"Economic Rightism"</span>)</span>
<span id="cb11-232"><a href="#cb11-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-233"><a href="#cb11-233" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the plots</span></span>
<span id="cb11-234"><a href="#cb11-234" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Social Conservatism Forest Plot:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Social Conservatism Forest Plot:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(social_forest_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Economic Rightism Forest Plot:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "\nEconomic Rightism Forest Plot:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(economic_forest_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a summary table</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> all_coeffs <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(outcome, model, coeff_label, estimate, ci_lower, ci_upper, p_value, significance) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_formatted =</span> <span class="fu">paste0</span>(<span class="st">"["</span>, <span class="fu">round</span>(ci_lower, <span class="dv">3</span>), <span class="st">", "</span>, <span class="fu">round</span>(ci_upper, <span class="dv">3</span>), <span class="st">"]"</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate_formatted =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(estimate, <span class="dv">3</span>), significance)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(outcome, model, coeff_label, estimate_formatted, ci_formatted, p_value) <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(outcome, coeff_label, model)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                 outcome              model
age25_TO_34...1                        Economic Rightism All Previous Waves
age25_TO_34...2                        Economic Rightism        Latest Wave
age35_TO_44...3                        Economic Rightism All Previous Waves
age35_TO_44...4                        Economic Rightism        Latest Wave
gendermale...5                         Economic Rightism All Previous Waves
gendermale...6                         Economic Rightism        Latest Wave
gendermale:age25_TO_34...7             Economic Rightism All Previous Waves
gendermale:age25_TO_34...8             Economic Rightism        Latest Wave
gendermale:age35_TO_44...9             Economic Rightism All Previous Waves
gendermale:age35_TO_44...10            Economic Rightism        Latest Wave
gendermale:age45_TO_54...11            Economic Rightism All Previous Waves
gendermale:age45_TO_54...12            Economic Rightism        Latest Wave
gendermale:age55_TO_64...13            Economic Rightism All Previous Waves
gendermale:age55_TO_64...14            Economic Rightism        Latest Wave
gendermale:regionGreater London...15   Economic Rightism All Previous Waves
gendermale:regionGreater London...16   Economic Rightism        Latest Wave
gendermale:educationlow...17           Economic Rightism All Previous Waves
gendermale:educationlow...18           Economic Rightism        Latest Wave
gendermale:regionScotland...19         Economic Rightism All Previous Waves
gendermale:regionScotland...20         Economic Rightism        Latest Wave
gendermale:regionWest Midlands...21    Economic Rightism All Previous Waves
gendermale:regionWest Midlands...22    Economic Rightism        Latest Wave
ethnicitymixed...23                    Economic Rightism All Previous Waves
ethnicitymixed...24                    Economic Rightism        Latest Wave
religionnone...25                      Economic Rightism All Previous Waves
religionnone...26                      Economic Rightism        Latest Wave
ethnicitywhite...27                    Economic Rightism All Previous Waves
ethnicitywhite...28                    Economic Rightism        Latest Wave
age25_TO_34...29                     Social Conservatism All Previous Waves
age25_TO_34...30                     Social Conservatism        Latest Wave
age35_TO_44...31                     Social Conservatism All Previous Waves
age35_TO_44...32                     Social Conservatism        Latest Wave
gendermale...33                      Social Conservatism All Previous Waves
gendermale...34                      Social Conservatism        Latest Wave
gendermale:age25_TO_34...35          Social Conservatism All Previous Waves
gendermale:age25_TO_34...36          Social Conservatism        Latest Wave
gendermale:age35_TO_44...37          Social Conservatism All Previous Waves
gendermale:age35_TO_44...38          Social Conservatism        Latest Wave
gendermale:age45_TO_54...39          Social Conservatism All Previous Waves
gendermale:age45_TO_54...40          Social Conservatism        Latest Wave
gendermale:age55_TO_64...41          Social Conservatism All Previous Waves
gendermale:age55_TO_64...42          Social Conservatism        Latest Wave
gendermale:regionGreater London...43 Social Conservatism All Previous Waves
gendermale:regionGreater London...44 Social Conservatism        Latest Wave
gendermale:educationlow...45         Social Conservatism All Previous Waves
gendermale:educationlow...46         Social Conservatism        Latest Wave
gendermale:regionScotland...47       Social Conservatism All Previous Waves
gendermale:regionScotland...48       Social Conservatism        Latest Wave
gendermale:regionWest Midlands...49  Social Conservatism All Previous Waves
gendermale:regionWest Midlands...50  Social Conservatism        Latest Wave
ethnicitymixed...51                  Social Conservatism All Previous Waves
ethnicitymixed...52                  Social Conservatism        Latest Wave
religionnone...53                    Social Conservatism All Previous Waves
religionnone...54                    Social Conservatism        Latest Wave
ethnicitywhite...55                  Social Conservatism All Previous Waves
ethnicitywhite...56                  Social Conservatism        Latest Wave
                                                coeff_label estimate_formatted
age25_TO_34...1                                   Age 25-34              0.011
age25_TO_34...2                                   Age 25-34             -0.007
age35_TO_44...3                                   Age 35-44             0.019.
age35_TO_44...4                                   Age 35-44             -0.002
gendermale...5                             Male (vs Female)           0.071***
gendermale...6                             Male (vs Female)              0.034
gendermale:age25_TO_34...7                 Male × Age 25-34           -0.031**
gendermale:age25_TO_34...8                 Male × Age 25-34            -0.031.
gendermale:age35_TO_44...9                 Male × Age 35-44          -0.054***
gendermale:age35_TO_44...10                Male × Age 35-44            -0.06**
gendermale:age45_TO_54...11                Male × Age 45-54          -0.056***
gendermale:age45_TO_54...12                Male × Age 45-54            -0.06**
gendermale:age55_TO_64...13                Male × Age 55-64          -0.044***
gendermale:age55_TO_64...14                Male × Age 55-64           -0.058**
gendermale:regionGreater London...15          Male × London             -0.023
gendermale:regionGreater London...16          Male × London               0.02
gendermale:educationlow...17         Male × Lower Education            -0.014.
gendermale:educationlow...18         Male × Lower Education             -0.011
gendermale:regionScotland...19              Male × Scotland           -0.047**
gendermale:regionScotland...20              Male × Scotland             -0.004
gendermale:regionWest Midlands...21    Male × West Midlands             -0.03.
gendermale:regionWest Midlands...22    Male × West Midlands              0.003
ethnicitymixed...23                         Mixed Ethnicity             -0.021
ethnicitymixed...24                         Mixed Ethnicity            -0.036*
religionnone...25                               No Religion          -0.028***
religionnone...26                               No Religion          -0.029***
ethnicitywhite...27                         White Ethnicity            -0.016.
ethnicitywhite...28                         White Ethnicity             -0.001
age25_TO_34...29                                  Age 25-34             0.021*
age25_TO_34...30                                  Age 25-34              0.027
age35_TO_44...31                                  Age 35-44             0.018.
age35_TO_44...32                                  Age 35-44              0.04*
gendermale...33                            Male (vs Female)              0.021
gendermale...34                            Male (vs Female)              0.019
gendermale:age25_TO_34...35                Male × Age 25-34              -0.01
gendermale:age25_TO_34...36                Male × Age 25-34             -0.007
gendermale:age35_TO_44...37                Male × Age 35-44             -0.012
gendermale:age35_TO_44...38                Male × Age 35-44             -0.016
gendermale:age45_TO_54...39                Male × Age 45-54            -0.026*
gendermale:age45_TO_54...40                Male × Age 45-54             -0.018
gendermale:age55_TO_64...41                Male × Age 55-64            -0.04**
gendermale:age55_TO_64...42                Male × Age 55-64            -0.034.
gendermale:regionGreater London...43          Male × London             0.028.
gendermale:regionGreater London...44          Male × London              0.001
gendermale:educationlow...45         Male × Lower Education            -0.012.
gendermale:educationlow...46         Male × Lower Education             -0.014
gendermale:regionScotland...47              Male × Scotland              0.001
gendermale:regionScotland...48              Male × Scotland             -0.017
gendermale:regionWest Midlands...49    Male × West Midlands            -0.029.
gendermale:regionWest Midlands...50    Male × West Midlands              0.016
ethnicitymixed...51                         Mixed Ethnicity          -0.072***
ethnicitymixed...52                         Mixed Ethnicity           -0.048**
religionnone...53                               No Religion          -0.074***
religionnone...54                               No Religion          -0.084***
ethnicitywhite...55                         White Ethnicity          -0.038***
ethnicitywhite...56                         White Ethnicity             -0.03*
                                         ci_formatted      p_value
age25_TO_34...1                        [-0.008, 0.03] 2.618416e-01
age25_TO_34...2                       [-0.037, 0.024] 6.647320e-01
age35_TO_44...3                            [0, 0.039] 5.542601e-02
age35_TO_44...4                        [-0.033, 0.03] 9.238029e-01
gendermale...5                         [0.039, 0.104] 1.584807e-05
gendermale...6                        [-0.015, 0.082] 1.758759e-01
gendermale:age25_TO_34...7           [-0.054, -0.008] 9.046130e-03
gendermale:age25_TO_34...8            [-0.068, 0.005] 9.429683e-02
gendermale:age35_TO_44...9           [-0.077, -0.031] 3.782808e-06
gendermale:age35_TO_44...10          [-0.096, -0.023] 1.308891e-03
gendermale:age45_TO_54...11           [-0.08, -0.033] 2.420071e-06
gendermale:age45_TO_54...12          [-0.097, -0.022] 1.674571e-03
gendermale:age55_TO_64...13          [-0.069, -0.019] 5.034695e-04
gendermale:age55_TO_64...14          [-0.098, -0.019] 4.031450e-03
gendermale:regionGreater London...15   [-0.055, 0.01] 1.687638e-01
gendermale:regionGreater London...16  [-0.028, 0.068] 4.155330e-01
gendermale:educationlow...17              [-0.029, 0] 5.042735e-02
gendermale:educationlow...18          [-0.034, 0.011] 3.316166e-01
gendermale:regionScotland...19       [-0.082, -0.012] 8.891126e-03
gendermale:regionScotland...20         [-0.059, 0.05] 8.745182e-01
gendermale:regionWest Midlands...21   [-0.063, 0.004] 8.224004e-02
gendermale:regionWest Midlands...22   [-0.049, 0.054] 9.214586e-01
ethnicitymixed...23                   [-0.049, 0.007] 1.340463e-01
ethnicitymixed...24                   [-0.07, -0.002] 3.629710e-02
religionnone...25                     [-0.035, -0.02] 2.056544e-12
religionnone...26                    [-0.041, -0.016] 3.862407e-06
ethnicitywhite...27                   [-0.032, 0.001] 5.939531e-02
ethnicitywhite...28                   [-0.026, 0.023] 9.269652e-01
age25_TO_34...29                           [0, 0.042] 4.958840e-02
age25_TO_34...30                      [-0.006, 0.061] 1.118921e-01
age35_TO_44...31                       [-0.003, 0.04] 9.046645e-02
age35_TO_44...32                       [0.005, 0.074] 2.456375e-02
gendermale...33                        [-0.01, 0.052] 1.812296e-01
gendermale...34                       [-0.027, 0.066] 4.140960e-01
gendermale:age25_TO_34...35           [-0.034, 0.014] 4.062649e-01
gendermale:age25_TO_34...36           [-0.045, 0.031] 7.246143e-01
gendermale:age35_TO_44...37           [-0.036, 0.012] 3.402588e-01
gendermale:age35_TO_44...38           [-0.055, 0.022] 4.018344e-01
gendermale:age45_TO_54...39           [-0.05, -0.002] 3.436802e-02
gendermale:age45_TO_54...40            [-0.057, 0.02] 3.421889e-01
gendermale:age55_TO_64...41          [-0.065, -0.015] 1.899878e-03
gendermale:age55_TO_64...42           [-0.073, 0.006] 9.558440e-02
gendermale:regionGreater London...43  [-0.001, 0.057] 5.857304e-02
gendermale:regionGreater London...44  [-0.044, 0.045] 9.770170e-01
gendermale:educationlow...45          [-0.026, 0.002] 8.792641e-02
gendermale:educationlow...46          [-0.036, 0.008] 2.227292e-01
gendermale:regionScotland...47        [-0.033, 0.035] 9.477069e-01
gendermale:regionScotland...48        [-0.067, 0.033] 5.123082e-01
gendermale:regionWest Midlands...49    [-0.06, 0.002] 6.937388e-02
gendermale:regionWest Midlands...50   [-0.029, 0.062] 4.856825e-01
ethnicitymixed...51                    [-0.1, -0.045] 3.314192e-07
ethnicitymixed...52                  [-0.081, -0.015] 4.433062e-03
religionnone...53                    [-0.081, -0.066] 2.321106e-87
religionnone...54                    [-0.095, -0.072] 9.590312e-45
ethnicitywhite...55                  [-0.054, -0.021] 6.646795e-06
ethnicitywhite...56                  [-0.054, -0.006] 1.352809e-02</code></pre>
</div>
</div>
</section>
<section id="issue-stance-trends-over-survey-waves" class="level4">
<h4 class="anchored" data-anchor-id="issue-stance-trends-over-survey-waves">Issue Stance Trends Over Survey Waves</h4>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate issue stances over waves for the 4 key issues from slides visuals</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>calculate_issue_trends <span class="ot">&lt;-</span> <span class="cf">function</span>(processed_waves) {</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the 4 key issues examined in slides visuals</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  target_issues <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"soc_censor"</span>, <span class="st">"soc_respect"</span>, <span class="st">"econ_onelaw"</span>, <span class="st">"soc_schools"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate weighted means for each issue across waves</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  issue_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (wave_idx <span class="cf">in</span> <span class="fu">seq_along</span>(processed_waves)) {</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    wave_data <span class="ot">&lt;-</span> processed_waves[[wave_idx]]</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    survey_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> wave_data, <span class="at">weights =</span> <span class="sc">~</span>wt)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate means by gender for each target issue</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    wave_results <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(target_issues, <span class="cf">function</span>(issue) {</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Overall means by gender</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>      gender_means <span class="ot">&lt;-</span> <span class="fu">svyby</span>(</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"~"</span>, issue)),</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span>gender,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">design =</span> survey_design,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">FUN =</span> svymean,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>          <span class="at">issue =</span> issue,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">wave =</span> wave_idx,</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>          <span class="at">issue_mean =</span> .data[[issue]],</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">issue_se =</span> se</span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(wave, issue, gender, issue_mean, issue_se)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(gender_means)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>    issue_results[[wave_idx]] <span class="ot">&lt;-</span> wave_results</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all waves</span></span>
<span id="cb19-41"><a href="#cb19-41" aria-hidden="true" tabindex="-1"></a>  combined_issues <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(issue_results)</span>
<span id="cb19-42"><a href="#cb19-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-43"><a href="#cb19-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(combined_issues)</span>
<span id="cb19-44"><a href="#cb19-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-45"><a href="#cb19-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-46"><a href="#cb19-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization for issue stance trends</span></span>
<span id="cb19-47"><a href="#cb19-47" aria-hidden="true" tabindex="-1"></a>create_issue_stance_plots <span class="ot">&lt;-</span> <span class="cf">function</span>(issue_data) {</span>
<span id="cb19-48"><a href="#cb19-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-49"><a href="#cb19-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set up issue labels and colors consistent with project theme</span></span>
<span id="cb19-50"><a href="#cb19-50" aria-hidden="true" tabindex="-1"></a>  issue_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb19-51"><a href="#cb19-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"soc_censor"</span> <span class="ot">=</span> <span class="st">"Censorship for</span><span class="sc">\n</span><span class="st">Moral Standards"</span>,</span>
<span id="cb19-52"><a href="#cb19-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">"soc_respect"</span> <span class="ot">=</span> <span class="st">"Young People Need</span><span class="sc">\n</span><span class="st">More Respect"</span>,</span>
<span id="cb19-53"><a href="#cb19-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">"econ_onelaw"</span> <span class="ot">=</span> <span class="st">"One Law for Rich,</span><span class="sc">\n</span><span class="st">Another for Poor"</span>,</span>
<span id="cb19-54"><a href="#cb19-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">"soc_schools"</span> <span class="ot">=</span> <span class="st">"Schools Should Teach</span><span class="sc">\n</span><span class="st">Children to Obey Authority"</span></span>
<span id="cb19-55"><a href="#cb19-55" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb19-56"><a href="#cb19-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-57"><a href="#cb19-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gender colors consistent with project</span></span>
<span id="cb19-58"><a href="#cb19-58" aria-hidden="true" tabindex="-1"></a>  gender_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">female =</span> <span class="st">"#E76F51"</span>, <span class="at">male =</span> <span class="st">"#2A9D8F"</span>)</span>
<span id="cb19-59"><a href="#cb19-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-60"><a href="#cb19-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare data with readable labels</span></span>
<span id="cb19-61"><a href="#cb19-61" aria-hidden="true" tabindex="-1"></a>  plot_data <span class="ot">&lt;-</span> issue_data <span class="sc">%&gt;%</span></span>
<span id="cb19-62"><a href="#cb19-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb19-63"><a href="#cb19-63" aria-hidden="true" tabindex="-1"></a>      <span class="at">issue_label =</span> issue_labels[issue],</span>
<span id="cb19-64"><a href="#cb19-64" aria-hidden="true" tabindex="-1"></a>      <span class="at">issue_domain =</span> <span class="fu">if_else</span>(<span class="fu">str_starts</span>(issue, <span class="st">"soc_"</span>), <span class="st">"Social Issues"</span>, <span class="st">"Economic Issues"</span>)</span>
<span id="cb19-65"><a href="#cb19-65" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-66"><a href="#cb19-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-67"><a href="#cb19-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create individual plots for each issue</span></span>
<span id="cb19-68"><a href="#cb19-68" aria-hidden="true" tabindex="-1"></a>  issue_plots <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">names</span>(issue_labels), <span class="cf">function</span>(target_issue) {</span>
<span id="cb19-69"><a href="#cb19-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-70"><a href="#cb19-70" aria-hidden="true" tabindex="-1"></a>    issue_subset <span class="ot">&lt;-</span> plot_data <span class="sc">%&gt;%</span></span>
<span id="cb19-71"><a href="#cb19-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(issue <span class="sc">==</span> target_issue)</span>
<span id="cb19-72"><a href="#cb19-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-73"><a href="#cb19-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(issue_subset, <span class="fu">aes</span>(<span class="at">x =</span> wave, <span class="at">y =</span> issue_mean, <span class="at">color =</span> gender, <span class="at">group =</span> gender)) <span class="sc">+</span></span>
<span id="cb19-74"><a href="#cb19-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb19-75"><a href="#cb19-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb19-76"><a href="#cb19-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> issue_mean <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>issue_se, </span>
<span id="cb19-77"><a href="#cb19-77" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ymax =</span> issue_mean <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>issue_se),</span>
<span id="cb19-78"><a href="#cb19-78" aria-hidden="true" tabindex="-1"></a>                   <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb19-79"><a href="#cb19-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_color_manual</span>(<span class="at">values =</span> gender_colors, <span class="at">name =</span> <span class="st">"Gender"</span>) <span class="sc">+</span></span>
<span id="cb19-80"><a href="#cb19-80" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(plot_data<span class="sc">$</span>wave)),</span>
<span id="cb19-81"><a href="#cb19-81" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, <span class="fu">sort</span>(<span class="fu">unique</span>(plot_data<span class="sc">$</span>wave)))) <span class="sc">+</span></span>
<span id="cb19-82"><a href="#cb19-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), </span>
<span id="cb19-83"><a href="#cb19-83" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb19-84"><a href="#cb19-84" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Strongly</span><span class="sc">\n</span><span class="st">Disagree"</span>, <span class="st">"Disagree"</span>, <span class="st">"Neutral"</span>, </span>
<span id="cb19-85"><a href="#cb19-85" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"Agree"</span>, <span class="st">"Strongly</span><span class="sc">\n</span><span class="st">Agree"</span>)) <span class="sc">+</span></span>
<span id="cb19-86"><a href="#cb19-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> issue_labels[target_issue],</span>
<span id="cb19-87"><a href="#cb19-87" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="st">"Survey Wave"</span>, </span>
<span id="cb19-88"><a href="#cb19-88" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> <span class="st">"Mean Agreement"</span>,</span>
<span id="cb19-89"><a href="#cb19-89" aria-hidden="true" tabindex="-1"></a>           <span class="at">caption =</span> <span class="st">"Error bars show 95% confidence intervals"</span>) <span class="sc">+</span></span>
<span id="cb19-90"><a href="#cb19-90" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb19-91"><a href="#cb19-91" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb19-92"><a href="#cb19-92" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb19-93"><a href="#cb19-93" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb19-94"><a href="#cb19-94" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span>
<span id="cb19-95"><a href="#cb19-95" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb19-96"><a href="#cb19-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-97"><a href="#cb19-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(issue_plots) <span class="ot">&lt;-</span> <span class="fu">names</span>(issue_labels)</span>
<span id="cb19-98"><a href="#cb19-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-99"><a href="#cb19-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create combined plot showing all issues</span></span>
<span id="cb19-100"><a href="#cb19-100" aria-hidden="true" tabindex="-1"></a>  combined_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> wave, <span class="at">y =</span> issue_mean, <span class="at">color =</span> gender, <span class="at">group =</span> gender)) <span class="sc">+</span></span>
<span id="cb19-101"><a href="#cb19-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb19-102"><a href="#cb19-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb19-103"><a href="#cb19-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> issue_mean <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>issue_se, </span>
<span id="cb19-104"><a href="#cb19-104" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymax =</span> issue_mean <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>issue_se),</span>
<span id="cb19-105"><a href="#cb19-105" aria-hidden="true" tabindex="-1"></a>                 <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb19-106"><a href="#cb19-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>issue_label, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-107"><a href="#cb19-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> gender_colors, <span class="at">name =</span> <span class="st">"Gender"</span>) <span class="sc">+</span></span>
<span id="cb19-108"><a href="#cb19-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(plot_data<span class="sc">$</span>wave)),</span>
<span id="cb19-109"><a href="#cb19-109" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, <span class="fu">sort</span>(<span class="fu">unique</span>(plot_data<span class="sc">$</span>wave)))) <span class="sc">+</span></span>
<span id="cb19-110"><a href="#cb19-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb19-111"><a href="#cb19-111" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Strongly</span><span class="sc">\n</span><span class="st">Disagree"</span>, <span class="st">"Disagree"</span>, <span class="st">"Neutral"</span>, </span>
<span id="cb19-112"><a href="#cb19-112" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Agree"</span>, <span class="st">"Strongly</span><span class="sc">\n</span><span class="st">Agree"</span>)) <span class="sc">+</span></span>
<span id="cb19-113"><a href="#cb19-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Issue Stance Trends by Gender Across Survey Waves"</span>,</span>
<span id="cb19-114"><a href="#cb19-114" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Key political attitudes tracked over time"</span>,</span>
<span id="cb19-115"><a href="#cb19-115" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Survey Wave"</span>, </span>
<span id="cb19-116"><a href="#cb19-116" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Mean Agreement Level"</span>,</span>
<span id="cb19-117"><a href="#cb19-117" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">"Error bars show 95% confidence intervals"</span>) <span class="sc">+</span></span>
<span id="cb19-118"><a href="#cb19-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb19-119"><a href="#cb19-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb19-120"><a href="#cb19-120" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb19-121"><a href="#cb19-121" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">color =</span> <span class="st">"grey40"</span>),</span>
<span id="cb19-122"><a href="#cb19-122" aria-hidden="true" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb19-123"><a href="#cb19-123" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb19-124"><a href="#cb19-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-125"><a href="#cb19-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb19-126"><a href="#cb19-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">individual =</span> issue_plots,</span>
<span id="cb19-127"><a href="#cb19-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">combined =</span> combined_plot</span>
<span id="cb19-128"><a href="#cb19-128" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb19-129"><a href="#cb19-129" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-130"><a href="#cb19-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-131"><a href="#cb19-131" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate issue trends across waves</span></span>
<span id="cb19-132"><a href="#cb19-132" aria-hidden="true" tabindex="-1"></a>issue_trends <span class="ot">&lt;-</span> <span class="fu">calculate_issue_trends</span>(processed_waves)</span>
<span id="cb19-133"><a href="#cb19-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-134"><a href="#cb19-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate issue stance plots</span></span>
<span id="cb19-135"><a href="#cb19-135" aria-hidden="true" tabindex="-1"></a>issue_plots <span class="ot">&lt;-</span> <span class="fu">create_issue_stance_plots</span>(issue_trends)</span>
<span id="cb19-136"><a href="#cb19-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-137"><a href="#cb19-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the combined plot showing all 4 key issues</span></span>
<span id="cb19-138"><a href="#cb19-138" aria-hidden="true" tabindex="-1"></a>issue_plots<span class="sc">$</span>combined</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display individual plots for detailed view</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>issue_plots<span class="sc">$</span>individual<span class="sc">$</span>soc_censor</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>issue_plots<span class="sc">$</span>individual<span class="sc">$</span>soc_respect  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>issue_plots<span class="sc">$</span>individual<span class="sc">$</span>econ_onelaw</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-6-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>issue_plots<span class="sc">$</span>individual<span class="sc">$</span>soc_schools</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="demo_future_wave_processing_final_files/figure-html/unnamed-chunk-6-5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>Above issue trends can be extended for age-group analysis.</p>
</section>
<section id="statistical-significance-testing-for-wave-to-wave-changes" class="level4">
<h4 class="anchored" data-anchor-id="statistical-significance-testing-for-wave-to-wave-changes">Statistical Significance Testing for Wave-to-Wave Changes</h4>
<p>Tests whether specific population groups experience a statistically significant difference from the current survey wave compared to all previous. Utilizes survey-based t-tests for statistical inference.</p>
<p>In future, could be extended to region and other demographic groupings. Currently focused on the contextually significant groups.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to test statistical significance using survey t-tests</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>test_wave_significance <span class="ot">&lt;-</span> <span class="cf">function</span>(processed_waves) {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Key metrics to test</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  metrics_to_test <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"social_conservatism"</span>, <span class="st">"economic_rightism"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store all significance tests</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  significance_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test each wave against all previous waves combined (cumulative approach)</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (current_wave <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(processed_waves)) {</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Current wave data</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    current_data <span class="ot">&lt;-</span> processed_waves[[current_wave]]</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># All previous waves combined for maximum power</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    previous_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(processed_waves[<span class="dv">1</span><span class="sc">:</span>(current_wave<span class="dv">-1</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">wave_group =</span> <span class="st">"previous"</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add wave group identifier</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    current_data <span class="ot">&lt;-</span> current_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">wave_group =</span> <span class="st">"current"</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine for t-test</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(previous_data, current_data)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    combined_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> combined_data, <span class="at">weights =</span> <span class="sc">~</span>wt)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Test each metric</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    wave_tests <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(metrics_to_test, <span class="cf">function</span>(metric) {</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Test overall population change</span></span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>      overall_test <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>        ttest_result <span class="ot">&lt;-</span> <span class="fu">svyttest</span>(</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.formula</span>(<span class="fu">paste</span>(metric, <span class="st">"~ wave_group"</span>)), </span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>          <span class="at">design =</span> combined_design</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calculate means for each group</span></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>        means_by_group <span class="ot">&lt;-</span> <span class="fu">svyby</span>(</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"~"</span>, metric)),</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>          <span class="sc">~</span>wave_group,</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">design =</span> combined_design,</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">FUN =</span> svymean,</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>        current_mean <span class="ot">&lt;-</span> means_by_group[means_by_group<span class="sc">$</span>wave_group <span class="sc">==</span> <span class="st">"current"</span>, metric]</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>        previous_mean <span class="ot">&lt;-</span> means_by_group[means_by_group<span class="sc">$</span>wave_group <span class="sc">==</span> <span class="st">"previous"</span>, metric]</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>          <span class="at">comparison =</span> <span class="st">"Overall Population"</span>,</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>          <span class="at">metric =</span> metric,</span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>          <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>          <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a>          <span class="at">difference =</span> current_mean <span class="sc">-</span> previous_mean,</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a>          <span class="at">t_statistic =</span> ttest_result<span class="sc">$</span>statistic,</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">p_value =</span> ttest_result<span class="sc">$</span>p.value,</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">significant =</span> ttest_result<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(</span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>          <span class="at">comparison =</span> <span class="st">"Overall Population"</span>,</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">metric =</span> metric,</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>          <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>          <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>          <span class="at">difference =</span> <span class="cn">NA</span>,</span>
<span id="cb24-67"><a href="#cb24-67" aria-hidden="true" tabindex="-1"></a>          <span class="at">t_statistic =</span> <span class="cn">NA</span>,</span>
<span id="cb24-68"><a href="#cb24-68" aria-hidden="true" tabindex="-1"></a>          <span class="at">p_value =</span> <span class="cn">NA</span>,</span>
<span id="cb24-69"><a href="#cb24-69" aria-hidden="true" tabindex="-1"></a>          <span class="at">significant =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-70"><a href="#cb24-70" aria-hidden="true" tabindex="-1"></a>          <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-71"><a href="#cb24-71" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-72"><a href="#cb24-72" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb24-73"><a href="#cb24-73" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-74"><a href="#cb24-74" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Test gender-specific changes</span></span>
<span id="cb24-75"><a href="#cb24-75" aria-hidden="true" tabindex="-1"></a>      gender_tests <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>), <span class="cf">function</span>(target_gender) {</span>
<span id="cb24-76"><a href="#cb24-76" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tryCatch</span>({</span>
<span id="cb24-77"><a href="#cb24-77" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Filter for specific gender</span></span>
<span id="cb24-78"><a href="#cb24-78" aria-hidden="true" tabindex="-1"></a>          gender_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(gender <span class="sc">==</span> target_gender)</span>
<span id="cb24-79"><a href="#cb24-79" aria-hidden="true" tabindex="-1"></a>          gender_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> gender_data, <span class="at">weights =</span> <span class="sc">~</span>wt)</span>
<span id="cb24-80"><a href="#cb24-80" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-81"><a href="#cb24-81" aria-hidden="true" tabindex="-1"></a>          ttest_result <span class="ot">&lt;-</span> <span class="fu">svyttest</span>(</span>
<span id="cb24-82"><a href="#cb24-82" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.formula</span>(<span class="fu">paste</span>(metric, <span class="st">"~ wave_group"</span>)), </span>
<span id="cb24-83"><a href="#cb24-83" aria-hidden="true" tabindex="-1"></a>            <span class="at">design =</span> gender_design</span>
<span id="cb24-84"><a href="#cb24-84" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-85"><a href="#cb24-85" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-86"><a href="#cb24-86" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Calculate means for this gender</span></span>
<span id="cb24-87"><a href="#cb24-87" aria-hidden="true" tabindex="-1"></a>          means_by_group <span class="ot">&lt;-</span> <span class="fu">svyby</span>(</span>
<span id="cb24-88"><a href="#cb24-88" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"~"</span>, metric)),</span>
<span id="cb24-89"><a href="#cb24-89" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span>wave_group,</span>
<span id="cb24-90"><a href="#cb24-90" aria-hidden="true" tabindex="-1"></a>            <span class="at">design =</span> gender_design,</span>
<span id="cb24-91"><a href="#cb24-91" aria-hidden="true" tabindex="-1"></a>            <span class="at">FUN =</span> svymean,</span>
<span id="cb24-92"><a href="#cb24-92" aria-hidden="true" tabindex="-1"></a>            <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb24-93"><a href="#cb24-93" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-94"><a href="#cb24-94" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-95"><a href="#cb24-95" aria-hidden="true" tabindex="-1"></a>          current_mean <span class="ot">&lt;-</span> means_by_group[means_by_group<span class="sc">$</span>wave_group <span class="sc">==</span> <span class="st">"current"</span>, metric]</span>
<span id="cb24-96"><a href="#cb24-96" aria-hidden="true" tabindex="-1"></a>          previous_mean <span class="ot">&lt;-</span> means_by_group[means_by_group<span class="sc">$</span>wave_group <span class="sc">==</span> <span class="st">"previous"</span>, metric]</span>
<span id="cb24-97"><a href="#cb24-97" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-98"><a href="#cb24-98" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>(</span>
<span id="cb24-99"><a href="#cb24-99" aria-hidden="true" tabindex="-1"></a>            <span class="at">comparison =</span> <span class="fu">paste</span>(<span class="fu">str_to_title</span>(target_gender), <span class="st">"Only"</span>),</span>
<span id="cb24-100"><a href="#cb24-100" aria-hidden="true" tabindex="-1"></a>            <span class="at">metric =</span> metric,</span>
<span id="cb24-101"><a href="#cb24-101" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-102"><a href="#cb24-102" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-103"><a href="#cb24-103" aria-hidden="true" tabindex="-1"></a>            <span class="at">difference =</span> current_mean <span class="sc">-</span> previous_mean,</span>
<span id="cb24-104"><a href="#cb24-104" aria-hidden="true" tabindex="-1"></a>            <span class="at">t_statistic =</span> ttest_result<span class="sc">$</span>statistic,</span>
<span id="cb24-105"><a href="#cb24-105" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_value =</span> ttest_result<span class="sc">$</span>p.value,</span>
<span id="cb24-106"><a href="#cb24-106" aria-hidden="true" tabindex="-1"></a>            <span class="at">significant =</span> ttest_result<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb24-107"><a href="#cb24-107" aria-hidden="true" tabindex="-1"></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-108"><a href="#cb24-108" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-109"><a href="#cb24-109" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb24-110"><a href="#cb24-110" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>(</span>
<span id="cb24-111"><a href="#cb24-111" aria-hidden="true" tabindex="-1"></a>            <span class="at">comparison =</span> <span class="fu">paste</span>(<span class="fu">str_to_title</span>(target_gender), <span class="st">"Only"</span>),</span>
<span id="cb24-112"><a href="#cb24-112" aria-hidden="true" tabindex="-1"></a>            <span class="at">metric =</span> metric,</span>
<span id="cb24-113"><a href="#cb24-113" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-114"><a href="#cb24-114" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-115"><a href="#cb24-115" aria-hidden="true" tabindex="-1"></a>            <span class="at">difference =</span> <span class="cn">NA</span>,</span>
<span id="cb24-116"><a href="#cb24-116" aria-hidden="true" tabindex="-1"></a>            <span class="at">t_statistic =</span> <span class="cn">NA</span>,</span>
<span id="cb24-117"><a href="#cb24-117" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_value =</span> <span class="cn">NA</span>,</span>
<span id="cb24-118"><a href="#cb24-118" aria-hidden="true" tabindex="-1"></a>            <span class="at">significant =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-119"><a href="#cb24-119" aria-hidden="true" tabindex="-1"></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-120"><a href="#cb24-120" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-121"><a href="#cb24-121" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb24-122"><a href="#cb24-122" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb24-123"><a href="#cb24-123" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-124"><a href="#cb24-124" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Test change in gender gap using interaction approach</span></span>
<span id="cb24-125"><a href="#cb24-125" aria-hidden="true" tabindex="-1"></a>      gap_test <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb24-126"><a href="#cb24-126" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create interaction between gender and wave_group</span></span>
<span id="cb24-127"><a href="#cb24-127" aria-hidden="true" tabindex="-1"></a>        combined_data_for_gap <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb24-128"><a href="#cb24-128" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mutate</span>(</span>
<span id="cb24-129"><a href="#cb24-129" aria-hidden="true" tabindex="-1"></a>            <span class="at">gender_wave =</span> <span class="fu">interaction</span>(gender, wave_group),</span>
<span id="cb24-130"><a href="#cb24-130" aria-hidden="true" tabindex="-1"></a>            <span class="at">gender_numeric =</span> <span class="fu">if_else</span>(gender <span class="sc">==</span> <span class="st">"male"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb24-131"><a href="#cb24-131" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_numeric =</span> <span class="fu">if_else</span>(wave_group <span class="sc">==</span> <span class="st">"current"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb24-132"><a href="#cb24-132" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-133"><a href="#cb24-133" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-134"><a href="#cb24-134" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use survey GLM to test interaction</span></span>
<span id="cb24-135"><a href="#cb24-135" aria-hidden="true" tabindex="-1"></a>        gap_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> combined_data_for_gap, <span class="at">weights =</span> <span class="sc">~</span>wt)</span>
<span id="cb24-136"><a href="#cb24-136" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-137"><a href="#cb24-137" aria-hidden="true" tabindex="-1"></a>        gap_model <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb24-138"><a href="#cb24-138" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as.formula</span>(<span class="fu">paste</span>(metric, <span class="st">"~ gender_numeric * wave_numeric"</span>)),</span>
<span id="cb24-139"><a href="#cb24-139" aria-hidden="true" tabindex="-1"></a>          <span class="at">design =</span> gap_design</span>
<span id="cb24-140"><a href="#cb24-140" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-141"><a href="#cb24-141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-142"><a href="#cb24-142" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract interaction coefficient (this tests if gender gap changed)</span></span>
<span id="cb24-143"><a href="#cb24-143" aria-hidden="true" tabindex="-1"></a>        interaction_coef <span class="ot">&lt;-</span> <span class="fu">summary</span>(gap_model)<span class="sc">$</span>coefficients[<span class="st">"gender_numeric:wave_numeric"</span>, ]</span>
<span id="cb24-144"><a href="#cb24-144" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb24-145"><a href="#cb24-145" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(</span>
<span id="cb24-146"><a href="#cb24-146" aria-hidden="true" tabindex="-1"></a>          <span class="at">comparison =</span> <span class="st">"Gender Gap Change"</span>,</span>
<span id="cb24-147"><a href="#cb24-147" aria-hidden="true" tabindex="-1"></a>          <span class="at">metric =</span> metric,</span>
<span id="cb24-148"><a href="#cb24-148" aria-hidden="true" tabindex="-1"></a>          <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-149"><a href="#cb24-149" aria-hidden="true" tabindex="-1"></a>          <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-150"><a href="#cb24-150" aria-hidden="true" tabindex="-1"></a>          <span class="at">difference =</span> interaction_coef[<span class="st">"Estimate"</span>],</span>
<span id="cb24-151"><a href="#cb24-151" aria-hidden="true" tabindex="-1"></a>          <span class="at">t_statistic =</span> interaction_coef[<span class="st">"t value"</span>],</span>
<span id="cb24-152"><a href="#cb24-152" aria-hidden="true" tabindex="-1"></a>          <span class="at">p_value =</span> interaction_coef[<span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb24-153"><a href="#cb24-153" aria-hidden="true" tabindex="-1"></a>          <span class="at">significant =</span> interaction_coef[<span class="st">"Pr(&gt;|t|)"</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb24-154"><a href="#cb24-154" aria-hidden="true" tabindex="-1"></a>          <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-155"><a href="#cb24-155" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-156"><a href="#cb24-156" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb24-157"><a href="#cb24-157" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(</span>
<span id="cb24-158"><a href="#cb24-158" aria-hidden="true" tabindex="-1"></a>          <span class="at">comparison =</span> <span class="st">"Gender Gap Change"</span>,</span>
<span id="cb24-159"><a href="#cb24-159" aria-hidden="true" tabindex="-1"></a>          <span class="at">metric =</span> metric,</span>
<span id="cb24-160"><a href="#cb24-160" aria-hidden="true" tabindex="-1"></a>          <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-161"><a href="#cb24-161" aria-hidden="true" tabindex="-1"></a>          <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-162"><a href="#cb24-162" aria-hidden="true" tabindex="-1"></a>          <span class="at">difference =</span> <span class="cn">NA</span>,</span>
<span id="cb24-163"><a href="#cb24-163" aria-hidden="true" tabindex="-1"></a>          <span class="at">t_statistic =</span> <span class="cn">NA</span>,</span>
<span id="cb24-164"><a href="#cb24-164" aria-hidden="true" tabindex="-1"></a>          <span class="at">p_value =</span> <span class="cn">NA</span>,</span>
<span id="cb24-165"><a href="#cb24-165" aria-hidden="true" tabindex="-1"></a>          <span class="at">significant =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-166"><a href="#cb24-166" aria-hidden="true" tabindex="-1"></a>          <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-167"><a href="#cb24-167" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb24-168"><a href="#cb24-168" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb24-169"><a href="#cb24-169" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-170"><a href="#cb24-170" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Test age-specific changes: Young (18-34) vs Older (35+)</span></span>
<span id="cb24-171"><a href="#cb24-171" aria-hidden="true" tabindex="-1"></a>      age_tests <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">c</span>(<span class="st">"young"</span>, <span class="st">"older"</span>), <span class="cf">function</span>(age_group) {</span>
<span id="cb24-172"><a href="#cb24-172" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tryCatch</span>({</span>
<span id="cb24-173"><a href="#cb24-173" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Create age groups</span></span>
<span id="cb24-174"><a href="#cb24-174" aria-hidden="true" tabindex="-1"></a>          age_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb24-175"><a href="#cb24-175" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(</span>
<span id="cb24-176"><a href="#cb24-176" aria-hidden="true" tabindex="-1"></a>              <span class="at">age_broad =</span> <span class="fu">case_when</span>(</span>
<span id="cb24-177"><a href="#cb24-177" aria-hidden="true" tabindex="-1"></a>                age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"18_TO_24"</span>, <span class="st">"25_TO_34"</span>) <span class="sc">~</span> <span class="st">"young"</span>,</span>
<span id="cb24-178"><a href="#cb24-178" aria-hidden="true" tabindex="-1"></a>                age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"35_TO_44"</span>, <span class="st">"45_TO_54"</span>, <span class="st">"55_TO_64"</span>, <span class="st">"65_TO_74"</span>, <span class="st">"75_PLUS"</span>) <span class="sc">~</span> <span class="st">"older"</span></span>
<span id="cb24-179"><a href="#cb24-179" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb24-180"><a href="#cb24-180" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb24-181"><a href="#cb24-181" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(age_broad <span class="sc">==</span> age_group, <span class="sc">!</span><span class="fu">is.na</span>(age_broad))</span>
<span id="cb24-182"><a href="#cb24-182" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-183"><a href="#cb24-183" aria-hidden="true" tabindex="-1"></a>          age_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> age_data, <span class="at">weights =</span> <span class="sc">~</span>wt)</span>
<span id="cb24-184"><a href="#cb24-184" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-185"><a href="#cb24-185" aria-hidden="true" tabindex="-1"></a>          ttest_result <span class="ot">&lt;-</span> <span class="fu">svyttest</span>(</span>
<span id="cb24-186"><a href="#cb24-186" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.formula</span>(<span class="fu">paste</span>(metric, <span class="st">"~ wave_group"</span>)), </span>
<span id="cb24-187"><a href="#cb24-187" aria-hidden="true" tabindex="-1"></a>            <span class="at">design =</span> age_design</span>
<span id="cb24-188"><a href="#cb24-188" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-189"><a href="#cb24-189" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-190"><a href="#cb24-190" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Calculate means for this age group</span></span>
<span id="cb24-191"><a href="#cb24-191" aria-hidden="true" tabindex="-1"></a>          means_by_group <span class="ot">&lt;-</span> <span class="fu">svyby</span>(</span>
<span id="cb24-192"><a href="#cb24-192" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"~"</span>, metric)),</span>
<span id="cb24-193"><a href="#cb24-193" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span>wave_group,</span>
<span id="cb24-194"><a href="#cb24-194" aria-hidden="true" tabindex="-1"></a>            <span class="at">design =</span> age_design,</span>
<span id="cb24-195"><a href="#cb24-195" aria-hidden="true" tabindex="-1"></a>            <span class="at">FUN =</span> svymean,</span>
<span id="cb24-196"><a href="#cb24-196" aria-hidden="true" tabindex="-1"></a>            <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb24-197"><a href="#cb24-197" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-198"><a href="#cb24-198" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-199"><a href="#cb24-199" aria-hidden="true" tabindex="-1"></a>          current_mean <span class="ot">&lt;-</span> means_by_group[means_by_group<span class="sc">$</span>wave_group <span class="sc">==</span> <span class="st">"current"</span>, metric]</span>
<span id="cb24-200"><a href="#cb24-200" aria-hidden="true" tabindex="-1"></a>          previous_mean <span class="ot">&lt;-</span> means_by_group[means_by_group<span class="sc">$</span>wave_group <span class="sc">==</span> <span class="st">"previous"</span>, metric]</span>
<span id="cb24-201"><a href="#cb24-201" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-202"><a href="#cb24-202" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>(</span>
<span id="cb24-203"><a href="#cb24-203" aria-hidden="true" tabindex="-1"></a>            <span class="at">comparison =</span> <span class="fu">paste</span>(<span class="fu">str_to_title</span>(age_group), <span class="st">"Ages Only"</span>),</span>
<span id="cb24-204"><a href="#cb24-204" aria-hidden="true" tabindex="-1"></a>            <span class="at">metric =</span> metric,</span>
<span id="cb24-205"><a href="#cb24-205" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-206"><a href="#cb24-206" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-207"><a href="#cb24-207" aria-hidden="true" tabindex="-1"></a>            <span class="at">difference =</span> current_mean <span class="sc">-</span> previous_mean,</span>
<span id="cb24-208"><a href="#cb24-208" aria-hidden="true" tabindex="-1"></a>            <span class="at">t_statistic =</span> ttest_result<span class="sc">$</span>statistic,</span>
<span id="cb24-209"><a href="#cb24-209" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_value =</span> ttest_result<span class="sc">$</span>p.value,</span>
<span id="cb24-210"><a href="#cb24-210" aria-hidden="true" tabindex="-1"></a>            <span class="at">significant =</span> ttest_result<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb24-211"><a href="#cb24-211" aria-hidden="true" tabindex="-1"></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-212"><a href="#cb24-212" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-213"><a href="#cb24-213" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb24-214"><a href="#cb24-214" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>(</span>
<span id="cb24-215"><a href="#cb24-215" aria-hidden="true" tabindex="-1"></a>            <span class="at">comparison =</span> <span class="fu">paste</span>(<span class="fu">str_to_title</span>(age_group), <span class="st">"Ages Only"</span>),</span>
<span id="cb24-216"><a href="#cb24-216" aria-hidden="true" tabindex="-1"></a>            <span class="at">metric =</span> metric,</span>
<span id="cb24-217"><a href="#cb24-217" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-218"><a href="#cb24-218" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-219"><a href="#cb24-219" aria-hidden="true" tabindex="-1"></a>            <span class="at">difference =</span> <span class="cn">NA</span>,</span>
<span id="cb24-220"><a href="#cb24-220" aria-hidden="true" tabindex="-1"></a>            <span class="at">t_statistic =</span> <span class="cn">NA</span>,</span>
<span id="cb24-221"><a href="#cb24-221" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_value =</span> <span class="cn">NA</span>,</span>
<span id="cb24-222"><a href="#cb24-222" aria-hidden="true" tabindex="-1"></a>            <span class="at">significant =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-223"><a href="#cb24-223" aria-hidden="true" tabindex="-1"></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-224"><a href="#cb24-224" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-225"><a href="#cb24-225" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb24-226"><a href="#cb24-226" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb24-227"><a href="#cb24-227" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-228"><a href="#cb24-228" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Test young gender gap vs older gender gap changes</span></span>
<span id="cb24-229"><a href="#cb24-229" aria-hidden="true" tabindex="-1"></a>      age_gender_gap_tests <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="fu">c</span>(<span class="st">"young"</span>, <span class="st">"older"</span>), <span class="cf">function</span>(age_group) {</span>
<span id="cb24-230"><a href="#cb24-230" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tryCatch</span>({</span>
<span id="cb24-231"><a href="#cb24-231" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Create age groups and test gender gap changes within each</span></span>
<span id="cb24-232"><a href="#cb24-232" aria-hidden="true" tabindex="-1"></a>          age_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb24-233"><a href="#cb24-233" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(</span>
<span id="cb24-234"><a href="#cb24-234" aria-hidden="true" tabindex="-1"></a>              <span class="at">age_broad =</span> <span class="fu">case_when</span>(</span>
<span id="cb24-235"><a href="#cb24-235" aria-hidden="true" tabindex="-1"></a>                age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"18_TO_24"</span>, <span class="st">"25_TO_34"</span>) <span class="sc">~</span> <span class="st">"young"</span>,</span>
<span id="cb24-236"><a href="#cb24-236" aria-hidden="true" tabindex="-1"></a>                age <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"35_TO_44"</span>, <span class="st">"45_TO_54"</span>, <span class="st">"55_TO_64"</span>, <span class="st">"65_TO_74"</span>, <span class="st">"75_PLUS"</span>) <span class="sc">~</span> <span class="st">"older"</span></span>
<span id="cb24-237"><a href="#cb24-237" aria-hidden="true" tabindex="-1"></a>              ),</span>
<span id="cb24-238"><a href="#cb24-238" aria-hidden="true" tabindex="-1"></a>              <span class="at">gender_numeric =</span> <span class="fu">if_else</span>(gender <span class="sc">==</span> <span class="st">"male"</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb24-239"><a href="#cb24-239" aria-hidden="true" tabindex="-1"></a>              <span class="at">wave_numeric =</span> <span class="fu">if_else</span>(wave_group <span class="sc">==</span> <span class="st">"current"</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb24-240"><a href="#cb24-240" aria-hidden="true" tabindex="-1"></a>            ) <span class="sc">%&gt;%</span></span>
<span id="cb24-241"><a href="#cb24-241" aria-hidden="true" tabindex="-1"></a>            <span class="fu">filter</span>(age_broad <span class="sc">==</span> age_group, <span class="sc">!</span><span class="fu">is.na</span>(age_broad))</span>
<span id="cb24-242"><a href="#cb24-242" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-243"><a href="#cb24-243" aria-hidden="true" tabindex="-1"></a>          age_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span><span class="dv">1</span>, <span class="at">data =</span> age_data, <span class="at">weights =</span> <span class="sc">~</span>wt)</span>
<span id="cb24-244"><a href="#cb24-244" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-245"><a href="#cb24-245" aria-hidden="true" tabindex="-1"></a>          gap_model <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(</span>
<span id="cb24-246"><a href="#cb24-246" aria-hidden="true" tabindex="-1"></a>            <span class="fu">as.formula</span>(<span class="fu">paste</span>(metric, <span class="st">"~ gender_numeric * wave_numeric"</span>)),</span>
<span id="cb24-247"><a href="#cb24-247" aria-hidden="true" tabindex="-1"></a>            <span class="at">design =</span> age_design</span>
<span id="cb24-248"><a href="#cb24-248" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-249"><a href="#cb24-249" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-250"><a href="#cb24-250" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Extract interaction coefficient</span></span>
<span id="cb24-251"><a href="#cb24-251" aria-hidden="true" tabindex="-1"></a>          interaction_coef <span class="ot">&lt;-</span> <span class="fu">summary</span>(gap_model)<span class="sc">$</span>coefficients[<span class="st">"gender_numeric:wave_numeric"</span>, ]</span>
<span id="cb24-252"><a href="#cb24-252" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb24-253"><a href="#cb24-253" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>(</span>
<span id="cb24-254"><a href="#cb24-254" aria-hidden="true" tabindex="-1"></a>            <span class="at">comparison =</span> <span class="fu">paste</span>(<span class="fu">str_to_title</span>(age_group), <span class="st">"Gender Gap Change"</span>),</span>
<span id="cb24-255"><a href="#cb24-255" aria-hidden="true" tabindex="-1"></a>            <span class="at">metric =</span> metric,</span>
<span id="cb24-256"><a href="#cb24-256" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-257"><a href="#cb24-257" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-258"><a href="#cb24-258" aria-hidden="true" tabindex="-1"></a>            <span class="at">difference =</span> interaction_coef[<span class="st">"Estimate"</span>],</span>
<span id="cb24-259"><a href="#cb24-259" aria-hidden="true" tabindex="-1"></a>            <span class="at">t_statistic =</span> interaction_coef[<span class="st">"t value"</span>],</span>
<span id="cb24-260"><a href="#cb24-260" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_value =</span> interaction_coef[<span class="st">"Pr(&gt;|t|)"</span>],</span>
<span id="cb24-261"><a href="#cb24-261" aria-hidden="true" tabindex="-1"></a>            <span class="at">significant =</span> interaction_coef[<span class="st">"Pr(&gt;|t|)"</span>] <span class="sc">&lt;</span> <span class="fl">0.05</span>,</span>
<span id="cb24-262"><a href="#cb24-262" aria-hidden="true" tabindex="-1"></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-263"><a href="#cb24-263" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-264"><a href="#cb24-264" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb24-265"><a href="#cb24-265" aria-hidden="true" tabindex="-1"></a>          <span class="fu">data.frame</span>(</span>
<span id="cb24-266"><a href="#cb24-266" aria-hidden="true" tabindex="-1"></a>            <span class="at">comparison =</span> <span class="fu">paste</span>(<span class="fu">str_to_title</span>(age_group), <span class="st">"Gender Gap Change"</span>),</span>
<span id="cb24-267"><a href="#cb24-267" aria-hidden="true" tabindex="-1"></a>            <span class="at">metric =</span> metric,</span>
<span id="cb24-268"><a href="#cb24-268" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_from =</span> <span class="fu">paste</span>(<span class="st">"Waves 1-"</span>, current_wave<span class="dv">-1</span>),</span>
<span id="cb24-269"><a href="#cb24-269" aria-hidden="true" tabindex="-1"></a>            <span class="at">wave_to =</span> <span class="fu">paste</span>(<span class="st">"Wave"</span>, current_wave),</span>
<span id="cb24-270"><a href="#cb24-270" aria-hidden="true" tabindex="-1"></a>            <span class="at">difference =</span> <span class="cn">NA</span>,</span>
<span id="cb24-271"><a href="#cb24-271" aria-hidden="true" tabindex="-1"></a>            <span class="at">t_statistic =</span> <span class="cn">NA</span>,</span>
<span id="cb24-272"><a href="#cb24-272" aria-hidden="true" tabindex="-1"></a>            <span class="at">p_value =</span> <span class="cn">NA</span>,</span>
<span id="cb24-273"><a href="#cb24-273" aria-hidden="true" tabindex="-1"></a>            <span class="at">significant =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-274"><a href="#cb24-274" aria-hidden="true" tabindex="-1"></a>            <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb24-275"><a href="#cb24-275" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb24-276"><a href="#cb24-276" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb24-277"><a href="#cb24-277" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb24-278"><a href="#cb24-278" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb24-279"><a href="#cb24-279" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Combine all tests for this metric</span></span>
<span id="cb24-280"><a href="#cb24-280" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_rows</span>(overall_test, gender_tests, gap_test, age_tests, age_gender_gap_tests)</span>
<span id="cb24-281"><a href="#cb24-281" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb24-282"><a href="#cb24-282" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb24-283"><a href="#cb24-283" aria-hidden="true" tabindex="-1"></a>    significance_results[[current_wave]] <span class="ot">&lt;-</span> wave_tests</span>
<span id="cb24-284"><a href="#cb24-284" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-285"><a href="#cb24-285" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-286"><a href="#cb24-286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all waves</span></span>
<span id="cb24-287"><a href="#cb24-287" aria-hidden="true" tabindex="-1"></a>  all_results <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(significance_results) <span class="sc">%&gt;%</span></span>
<span id="cb24-288"><a href="#cb24-288" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb24-289"><a href="#cb24-289" aria-hidden="true" tabindex="-1"></a>      <span class="at">wave_comparison =</span> <span class="fu">paste</span>(wave_from, <span class="st">"vs"</span>, wave_to),</span>
<span id="cb24-290"><a href="#cb24-290" aria-hidden="true" tabindex="-1"></a>      <span class="at">metric_label =</span> <span class="fu">case_when</span>(</span>
<span id="cb24-291"><a href="#cb24-291" aria-hidden="true" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">"social_conservatism"</span> <span class="sc">~</span> <span class="st">"Social Conservatism"</span>,</span>
<span id="cb24-292"><a href="#cb24-292" aria-hidden="true" tabindex="-1"></a>        metric <span class="sc">==</span> <span class="st">"economic_rightism"</span> <span class="sc">~</span> <span class="st">"Economic Rightism"</span></span>
<span id="cb24-293"><a href="#cb24-293" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb24-294"><a href="#cb24-294" aria-hidden="true" tabindex="-1"></a>      <span class="at">significance_level =</span> <span class="fu">case_when</span>(</span>
<span id="cb24-295"><a href="#cb24-295" aria-hidden="true" tabindex="-1"></a>        <span class="fu">is.na</span>(p_value) <span class="sc">~</span> <span class="st">"Not Tested"</span>,</span>
<span id="cb24-296"><a href="#cb24-296" aria-hidden="true" tabindex="-1"></a>        p_value <span class="sc">&lt;</span> <span class="fl">0.001</span> <span class="sc">~</span> <span class="st">"***"</span>,</span>
<span id="cb24-297"><a href="#cb24-297" aria-hidden="true" tabindex="-1"></a>        p_value <span class="sc">&lt;</span> <span class="fl">0.01</span> <span class="sc">~</span> <span class="st">"**"</span>, </span>
<span id="cb24-298"><a href="#cb24-298" aria-hidden="true" tabindex="-1"></a>        p_value <span class="sc">&lt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"*"</span>,</span>
<span id="cb24-299"><a href="#cb24-299" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">""</span></span>
<span id="cb24-300"><a href="#cb24-300" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb24-301"><a href="#cb24-301" aria-hidden="true" tabindex="-1"></a>      <span class="at">alert_level =</span> <span class="fu">case_when</span>(</span>
<span id="cb24-302"><a href="#cb24-302" aria-hidden="true" tabindex="-1"></a>        significant <span class="sc">&amp;</span> <span class="fu">abs</span>(difference) <span class="sc">&gt;</span> <span class="fl">0.05</span> <span class="sc">~</span> <span class="st">"HIGH"</span>,</span>
<span id="cb24-303"><a href="#cb24-303" aria-hidden="true" tabindex="-1"></a>        significant <span class="sc">&amp;</span> <span class="fu">abs</span>(difference) <span class="sc">&gt;</span> <span class="fl">0.02</span> <span class="sc">~</span> <span class="st">"MEDIUM"</span>,</span>
<span id="cb24-304"><a href="#cb24-304" aria-hidden="true" tabindex="-1"></a>        significant <span class="sc">~</span> <span class="st">"LOW"</span>,</span>
<span id="cb24-305"><a href="#cb24-305" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"NONE"</span></span>
<span id="cb24-306"><a href="#cb24-306" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb24-307"><a href="#cb24-307" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-308"><a href="#cb24-308" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-309"><a href="#cb24-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(all_results)</span>
<span id="cb24-310"><a href="#cb24-310" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-311"><a href="#cb24-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-312"><a href="#cb24-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-313"><a href="#cb24-313" aria-hidden="true" tabindex="-1"></a><span class="co"># Run significance testing</span></span>
<span id="cb24-314"><a href="#cb24-314" aria-hidden="true" tabindex="-1"></a>wave_significance <span class="ot">&lt;-</span> <span class="fu">test_wave_significance</span>(processed_waves)</span>
<span id="cb24-315"><a href="#cb24-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-316"><a href="#cb24-316" aria-hidden="true" tabindex="-1"></a><span class="co"># Display results</span></span>
<span id="cb24-317"><a href="#cb24-317" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Statistical Significance Testing Complete"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Statistical Significance Testing Complete"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Total tests performed:"</span>, <span class="fu">nrow</span>(wave_significance)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Total tests performed: 48"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Significant changes detected:"</span>, <span class="fu">sum</span>(wave_significance<span class="sc">$</span>significant, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Significant changes detected: 1"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display significance test results table</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"SIGNIFICANCE TEST RESULTS:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SIGNIFICANCE TEST RESULTS:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(wave_significance <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(wave_comparison, metric_label, comparison, difference, p_value, significance_level, alert_level) <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(wave_comparison, metric_label, comparison))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   wave_comparison        metric_label              comparison
t...1         Waves 1- 1 vs Wave 2   Economic Rightism             Female Only
Estimate...2  Waves 1- 1 vs Wave 2   Economic Rightism       Gender Gap Change
t...3         Waves 1- 1 vs Wave 2   Economic Rightism               Male Only
t...4         Waves 1- 1 vs Wave 2   Economic Rightism         Older Ages Only
Estimate...5  Waves 1- 1 vs Wave 2   Economic Rightism Older Gender Gap Change
t...6         Waves 1- 1 vs Wave 2   Economic Rightism      Overall Population
t...7         Waves 1- 1 vs Wave 2   Economic Rightism         Young Ages Only
Estimate...8  Waves 1- 1 vs Wave 2   Economic Rightism Young Gender Gap Change
t...9         Waves 1- 1 vs Wave 2 Social Conservatism             Female Only
Estimate...10 Waves 1- 1 vs Wave 2 Social Conservatism       Gender Gap Change
t...11        Waves 1- 1 vs Wave 2 Social Conservatism               Male Only
t...12        Waves 1- 1 vs Wave 2 Social Conservatism         Older Ages Only
Estimate...13 Waves 1- 1 vs Wave 2 Social Conservatism Older Gender Gap Change
t...14        Waves 1- 1 vs Wave 2 Social Conservatism      Overall Population
t...15        Waves 1- 1 vs Wave 2 Social Conservatism         Young Ages Only
Estimate...16 Waves 1- 1 vs Wave 2 Social Conservatism Young Gender Gap Change
t...17        Waves 1- 2 vs Wave 3   Economic Rightism             Female Only
Estimate...18 Waves 1- 2 vs Wave 3   Economic Rightism       Gender Gap Change
t...19        Waves 1- 2 vs Wave 3   Economic Rightism               Male Only
t...20        Waves 1- 2 vs Wave 3   Economic Rightism         Older Ages Only
Estimate...21 Waves 1- 2 vs Wave 3   Economic Rightism Older Gender Gap Change
t...22        Waves 1- 2 vs Wave 3   Economic Rightism      Overall Population
t...23        Waves 1- 2 vs Wave 3   Economic Rightism         Young Ages Only
Estimate...24 Waves 1- 2 vs Wave 3   Economic Rightism Young Gender Gap Change
t...25        Waves 1- 2 vs Wave 3 Social Conservatism             Female Only
Estimate...26 Waves 1- 2 vs Wave 3 Social Conservatism       Gender Gap Change
t...27        Waves 1- 2 vs Wave 3 Social Conservatism               Male Only
t...28        Waves 1- 2 vs Wave 3 Social Conservatism         Older Ages Only
Estimate...29 Waves 1- 2 vs Wave 3 Social Conservatism Older Gender Gap Change
t...30        Waves 1- 2 vs Wave 3 Social Conservatism      Overall Population
t...31        Waves 1- 2 vs Wave 3 Social Conservatism         Young Ages Only
Estimate...32 Waves 1- 2 vs Wave 3 Social Conservatism Young Gender Gap Change
t...33        Waves 1- 3 vs Wave 4   Economic Rightism             Female Only
Estimate...34 Waves 1- 3 vs Wave 4   Economic Rightism       Gender Gap Change
t...35        Waves 1- 3 vs Wave 4   Economic Rightism               Male Only
t...36        Waves 1- 3 vs Wave 4   Economic Rightism         Older Ages Only
Estimate...37 Waves 1- 3 vs Wave 4   Economic Rightism Older Gender Gap Change
t...38        Waves 1- 3 vs Wave 4   Economic Rightism      Overall Population
t...39        Waves 1- 3 vs Wave 4   Economic Rightism         Young Ages Only
Estimate...40 Waves 1- 3 vs Wave 4   Economic Rightism Young Gender Gap Change
t...41        Waves 1- 3 vs Wave 4 Social Conservatism             Female Only
Estimate...42 Waves 1- 3 vs Wave 4 Social Conservatism       Gender Gap Change
t...43        Waves 1- 3 vs Wave 4 Social Conservatism               Male Only
t...44        Waves 1- 3 vs Wave 4 Social Conservatism         Older Ages Only
Estimate...45 Waves 1- 3 vs Wave 4 Social Conservatism Older Gender Gap Change
t...46        Waves 1- 3 vs Wave 4 Social Conservatism      Overall Population
t...47        Waves 1- 3 vs Wave 4 Social Conservatism         Young Ages Only
Estimate...48 Waves 1- 3 vs Wave 4 Social Conservatism Young Gender Gap Change
                 difference    p_value significance_level alert_level
t...1         -0.0011431405 0.83655033                           NONE
Estimate...2   0.0026565947 0.76969474                           NONE
t...3          0.0015134542 0.83320303                           NONE
t...4          0.0015585441 0.78121419                           NONE
Estimate...5   0.0064348665 0.56736425                           NONE
t...6          0.0001279367 0.97727321                           NONE
t...7         -0.0035388048 0.60159360                           NONE
Estimate...8  -0.0089192522 0.52159179                           NONE
t...9         -0.0087687000 0.10944260                           NONE
Estimate...10  0.0048421774 0.57512084                           NONE
t...11        -0.0039265227 0.55672661                           NONE
t...12        -0.0028293820 0.58068535                           NONE
Estimate...13  0.0011571893 0.91024556                           NONE
t...14        -0.0064623711 0.13163135                           NONE
t...15        -0.0156570858 0.03455909                  *         LOW
Estimate...16  0.0113977145 0.45065809                           NONE
t...17        -0.0025756532 0.57999476                           NONE
Estimate...18  0.0029528513 0.70295620                           NONE
t...19         0.0003771981 0.95140313                           NONE
t...20         0.0001922451 0.96800352                           NONE
Estimate...21  0.0109189958 0.25596141                           NONE
t...22        -0.0011620921 0.76154104                           NONE
t...23        -0.0052998948 0.34735693                           NONE
Estimate...24 -0.0192782833 0.09496078                           NONE
t...25         0.0006666512 0.88737401                           NONE
Estimate...26  0.0026353783 0.72425172                           NONE
t...27         0.0033020294 0.56922802                           NONE
t...28        -0.0003182928 0.94327390                           NONE
Estimate...29 -0.0014009949 0.87584259                           NONE
t...30         0.0019304319 0.60243518                           NONE
t...31         0.0069175068 0.26584412                           NONE
Estimate...32  0.0158761957 0.20851884                           NONE
t...33         0.0036076110 0.39975452                           NONE
Estimate...34 -0.0048819591 0.47462903                           NONE
t...35        -0.0012743481 0.81059178                           NONE
t...36         0.0016036889 0.70374991                           NONE
Estimate...37 -0.0089176080 0.29152005                           NONE
t...38         0.0012704436 0.70750443                           NONE
t...39         0.0008711948 0.86670284                           NONE
Estimate...40  0.0057579891 0.58779338                           NONE
t...41        -0.0028608230 0.48906630                           NONE
Estimate...42  0.0005403927 0.93467403                           NONE
t...43        -0.0023204303 0.65135757                           NONE
t...44        -0.0008718807 0.82364066                           NONE
Estimate...45  0.0033096295 0.67308072                           NONE
t...46        -0.0025970853 0.42706650                           NONE
t...47        -0.0061192991 0.27778167                           NONE
Estimate...48 -0.0067578205 0.55670645                           NONE</code></pre>
</div>
</div>
</section>
<section id="future-extensions" class="level4">
<h4 class="anchored" data-anchor-id="future-extensions">Future extensions</h4>
<p>R-shiny based dashboard to allow interactive exploration of trends, gaps, and significance testing results over time, splitting by demographics and outcomes.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
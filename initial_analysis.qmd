---
title: "UK Political Gender Divide Survey Analysis"
format: html
execute:
  echo: true          # Show code chunks
  warning: false      # Hide warnings
  error: false        # Hide error messages
  message: false      # Hide messages (like library loading messages)
  cache: false        # Set to true if you want to cache results
  freeze: auto        # Prevents re-execution unless code changes
knitr:
  opts_chunk:
    fig.align: center  # Center figures
    fig.width: 8       # Default figure width
    fig.height: 6      # Default figure height
    out.width: "80%"   # Scale output width
    dpi: 300          # High resolution figures
---

#### Research questions:

what evidence of this ideological gender divide exists in the UK and is it different across generations?

young peopleʼs attitudes and if we can challenge the idea theyʼre a monolith

how do the above translate into public-facing guidance for the FTSE CEO?

what is the divide? do economic or social views drive the divide that we're experiencing? can this be drilled down into specific areas of either?

```{r}
source('scripts/setup.R')
```

#### Analysis plan

1)  Verify data integrity, create composite social/economic scales

2)  Generate average scorings based on age-group, calculate differences by individual to age-group scores - how do individual differ from their age cohort?

3)  Quantify the size of gender differences in liberal/authoritarian attitudes across age groups:

-   did the 2024 vote exhibit the gender gap? (age/vote distribution by party vote 2024)
-   is the gap wider amongst younger generations vs. other? (gap size by age band)
-   specific issue gaps?

4)  Modelling stage - how does age, gender, other demographics predict ideology?

-   how can we predict party vote, conservatism, economic leftism using the demographic information that we have (weighted regression)?

5)  Segmented modelling - how do young people experience different effects to those of all voters?

6)  Visualization creation, draw out most relevant insights from the above stages

7)  Extended segment analysis

-   What specific ideological markers are significant for corporate positioning strategy? What specific dimension is driving the growing gender divide for the future?
-   is this happening mostly in urban areas? can we merge in additional data via use of constituency codes?

8)  Based on above results, incorporate into a unified tracking function in new document

-   Test this function using survey waves from randomly selected batches from the main data, label for multiple months as proof of concept working.

### How do we measure political ideology?

1)  social preferences - conservatism variable

2)  economic preferences - economic leftism variable

3)  2024 party vote - between reform, labour, greens, conservatives, etc.

4)  Tailored topic viewpoints - big business, traditional values, death penalty etc.

<!-- First stage analysis (basically, where do things stand now?, what is the state of the gender gap across generations from the information that we have now?): -->

<!-- -   Quantify the size of gender differences in liberal/authoritarian attitudes across age groups -->

<!-- -   Show if the gap is wider among younger generations (18-34) vs other -->

<!-- -   Key metric: Gap size in composite social attitudes scale by age band -->

<!-- -   weighted regression model - effect of age, gender, age:gender interaction, education, ethnicity, region, household, religion, social_grade classification, marital status on conservatism + economic leftism + combined right-wing score -->

<!-- 3) Specific guidance - how can messaging and PR change for the company? -->

<!-- -   Challenge the "young monolith" assumption by showing attitude distributions within 18-34 demographic -->

<!-- -   Segment young men vs young women across both economic and social dimensions -->

<!-- -   Identify distinct clusters for targeted messaging -->

<!-- 4) Tracking Dashboard Framework -->

<!-- -   Automated functions to monitor changes over time -->

<!-- -   Key indicators: gender gap trends, generational shifts, attitude polarization metrics -->

<!-- -   Proof of concept using monthly splits from current data -->

#### 1) Verify data quality/integrity

```{r}
library(VIM)
#VIM::aggr(uk_data, plot = FALSE)

#unique(uk_data$eu_ref)


# we treat don't know as missing data
# sapply(uk_data[,c(3:6, 11:27)], unique)

# apply unique to all data

# encode NA's appropriately
uk_data <- uk_data %>%
  mutate(across(everything(), ~case_when(
    .x == "Don't know" ~ NA,
    .x == "dk" ~ NA,
    .x == "no_answer" ~ NA,           # religion column
    .x == "prefer_not_to_say" ~ NA,   # marital column
    TRUE ~ .x
  )))

VIM::aggr(uk_data, plot = FALSE)

```

Generally very few NAs in the data. Roughly equal rates across survey questions.

#### 2) Create Composite Economic/Social Ideology Scales

In future, consider encoding to 0 to 1 scale for ease of interpretation.
```{r}
# Function to recode attitude responses to -1 to 1 scale
recode_attitude <- function(x) {
  case_when(
    x == "Strongly agree" ~ 1,
    x == "Agree" ~ 0.5,
    x == "Neither agree nor disagree" ~ 0,
    x == "Disagree" ~ -0.5,
    x == "Strongly disagree" ~ -1,
    TRUE ~ NA_real_
  )
}

# Convert attitude variables to numeric and create scales
uk_data_test <- uk_data %>%
  mutate(
    # Convert social attitude variables to numeric (-2 to 2 scale)
    soc_respect = recode_attitude(soc_respect),
    soc_deathpen = recode_attitude(soc_deathpen),
    soc_schools = recode_attitude(soc_schools),
    soc_censor = recode_attitude(soc_censor),
    soc_punish = recode_attitude(soc_punish),
    # Convert economic attitude variables to numeric (-2 to 2 scale)
    econ_redist = recode_attitude(econ_redist),
    econ_bigbiz = recode_attitude(econ_bigbiz),
    econ_unfair = recode_attitude(econ_unfair),
    econ_onelaw = recode_attitude(econ_onelaw),
    econ_exploit = recode_attitude(econ_exploit)) %>% 
  rowwise() %>%
  mutate(
    social_conservatism = mean(c_across(c(soc_respect, soc_deathpen, soc_schools, soc_censor, soc_punish)), na.rm = TRUE),
    economic_leftism = mean(c_across(c(econ_redist, econ_bigbiz, econ_unfair, econ_onelaw, econ_exploit)), na.rm = TRUE),
    social_na_count = sum(is.na(c_across(c(soc_respect, soc_deathpen, soc_schools, soc_censor, soc_punish)))),
    economic_na_count = sum(is.na(c_across(c(econ_redist, econ_bigbiz, econ_unfair, econ_onelaw, econ_exploit))))
  ) %>%
  ungroup()

uk_data <- uk_data_test

summary(uk_data_test$social_conservatism)

uk_data_test %>% 
  filter(is.na(social_conservatism)) %>% 
  print()
```

above scale creation could be optimized for efficiency down the line. Rowwise operations decrease efficiency, could be eliminated.

Interpreting the scales: 
-   agreement with the social questions implies high social conservatism 
-   agreement with the economic questions implise high economic leftism

We expect a traditionally 'ri

#### 3) Quantify size of gender differences across age groups

##### Vote shares in 2024 election by Gender and Age Bands

```{r}
# create a visualization that shows, for each gender in each age band, their vote split in the 2024 election

# First, let's examine the vote choices available
cat("Available 2024 vote choices:\n")
print(unique(uk_data$pv_2024))

# Calculate weighted vote shares by gender and age group
vote_shares <- uk_data %>%
  filter(!is.na(pv_2024) & !is.na(gender) & !is.na(age)) %>%
  group_by(age, gender, pv_2024) %>%
  summarise(
    weighted_count = sum(wt, na.rm = TRUE),
    .groups = "keep"
  ) %>%
  group_by(age, gender) %>%
  mutate(
    total_weighted = sum(weighted_count),
    vote_share = weighted_count / total_weighted * 100
  ) %>%
  ungroup()

# Display the data
print("Vote shares by age, gender, and party:")
print(vote_shares)

# visualization - side-by-side comparison for key parties
major_parties <- vote_shares %>%
  filter(pv_2024 %in% c("con", "lab", "ldm", "rfm", "grn"))

ggplot(major_parties, aes(x = age, y = vote_share, fill = gender)) +
  geom_col(position = "dodge") +
  facet_wrap(~pv_2024, scales = "free_y") +
  labs(
    title = "Gender Differences in 2024 Vote Choice by Age Group",
    subtitle = "Side-by-side comparison for major parties",
    x = "Age Group",
    y = "Vote Share (%)",
    fill = "Gender"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    strip.text = element_text(face = "bold")
  ) +
  scale_fill_manual(values = c("male" = "lightblue", "female" = "pink"))
```

##### Average social conservatism by gender/age bands

```{r}
# Load survey package for proper weighted calculations
library(survey)

# Create survey design object
survey_design <- svydesign(
  ids = ~1,  # no clustering
  weights = ~wt,
  data = uk_data %>% filter(!is.na(social_conservatism) & !is.na(gender) & !is.na(age))
)

# Calculate survey-weighted means by age and gender
social_conservatism_means <- svyby(
  ~social_conservatism,
  ~age + gender,
  design = survey_design,
  FUN = svymean,
  na.rm = TRUE
)

# Convert to data frame and clean up
social_conservatism_means <- as.data.frame(social_conservatism_means) %>%
  rename(mean_social_conservatism = social_conservatism)

# Display the results
print("Survey-weighted means by age and gender:")
print(social_conservatism_means)

# Create barplot
ggplot(social_conservatism_means, aes(x = age, y = mean_social_conservatism, fill = gender)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = mean_social_conservatism - se,
                    ymax = mean_social_conservatism + se),
                position = position_dodge(width = 0.9), width = 0.25, alpha = 0.7) +
  labs(
    title = "Average Social Conservatism Scores by Age Group and Gender",
    subtitle = "Survey-weighted means with standard errors. Higher scores = more conservative",
    x = "Age Group",
    y = "Mean Social Conservatism Score",
    fill = "Gender"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_manual(values = c("male" = "lightblue", "female" = "pink"))
```

##### Average economic leftism by gender/age bands

```{r}
# Calculate survey-weighted means for economic leftism by age and gender
economic_leftism_means <- svyby(
  ~economic_leftism,
  ~age + gender,
  design = survey_design,
  FUN = svymean,
  na.rm = TRUE
)

# Convert to data frame and clean up
economic_leftism_means <- as.data.frame(economic_leftism_means) %>%
  rename(mean_economic_leftism = economic_leftism)

# Display the results
print("Survey-weighted economic leftism means by age and gender:")
print(economic_leftism_means)

# Create barplot
ggplot(economic_leftism_means, aes(x = age, y = mean_economic_leftism, fill = gender)) +
  geom_col(position = "dodge") +
  geom_errorbar(aes(ymin = mean_economic_leftism - se,
                    ymax = mean_economic_leftism + se),
                position = position_dodge(width = 0.9), width = 0.25, alpha = 0.7) +
  labs(
    title = "Average Economic Leftism Scores by Age Group and Gender",
    subtitle = "Survey-weighted means with standard errors. Higher scores = more left-wing",
    x = "Age Group",
    y = "Mean Economic Leftism Score",
    fill = "Gender"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_fill_manual(values = c("male" = "lightblue", "female" = "pink"))
```

##### Average social conservatism by exact age

```{r}
# Create survey design object for exact age analysis
survey_design_exact_age <- svydesign(
  ids = ~1,
  weights = ~wt,
  data = uk_data %>% filter(!is.na(social_conservatism) & !is.na(gender) & !is.na(exact_age))
)

# Calculate survey-weighted means by exact age and gender
social_conservatism_by_age <- svyby(
  ~social_conservatism,
  ~exact_age + gender,
  design = survey_design_exact_age,
  FUN = svymean,
  na.rm = TRUE
)

# Convert to data frame and clean up
social_conservatism_by_age <- as.data.frame(social_conservatism_by_age) %>%
  rename(mean_social_conservatism = social_conservatism)

# Create line plot with confidence intervals
ggplot(social_conservatism_by_age, aes(x = exact_age, y = mean_social_conservatism, color = gender)) +
  geom_line(size = 1.2) +
  geom_ribbon(aes(ymin = mean_social_conservatism - 1.96*se,
                  ymax = mean_social_conservatism + 1.96*se,
                  fill = gender),
              alpha = 0.3, linetype = 0) +
  labs(
    title = "Average Social Conservatism by Exact Age and Gender",
    subtitle = "Survey-weighted means with 95% confidence intervals. Higher scores = more conservative",
    x = "Age (Years)",
    y = "Mean Social Conservatism Score",
    color = "Gender",
    fill = "Gender"
  ) +
  theme_minimal() +
  scale_color_manual(values = c("male" = "steelblue", "female" = "coral")) +
  scale_fill_manual(values = c("male" = "steelblue", "female" = "coral")) +
  theme(legend.position = "bottom")
```

##### Average economic leftism by exact age

```{r}
# Calculate survey-weighted means for economic leftism by exact age and gender
economic_leftism_by_age <- svyby(
  ~economic_leftism,
  ~exact_age + gender,
  design = survey_design_exact_age,
  FUN = svymean,
  na.rm = TRUE
)

# Convert to data frame and clean up
economic_leftism_by_age <- as.data.frame(economic_leftism_by_age) %>%
  rename(mean_economic_leftism = economic_leftism)

# Create line plot with confidence intervals
ggplot(economic_leftism_by_age, aes(x = exact_age, y = mean_economic_leftism, color = gender)) +
  geom_line(size = 1.2) +
  geom_ribbon(aes(ymin = mean_economic_leftism - 1.96*se,
                  ymax = mean_economic_leftism + 1.96*se,
                  fill = gender),
              alpha = 0.3, linetype = 0) +
  labs(
    title = "Average Economic Leftism by Exact Age and Gender",
    subtitle = "Survey-weighted means with 95% confidence intervals. Higher scores = more left-wing",
    x = "Age (Years)",
    y = "Mean Economic Leftism Score",
    color = "Gender",
    fill = "Gender"
  ) +
  theme_minimal() +
  scale_color_manual(values = c("male" = "steelblue", "female" = "coral")) +
  scale_fill_manual(values = c("male" = "steelblue", "female" = "coral")) +
  theme(legend.position = "bottom")
```

##### Gender Gap Summary Table

```{r}
# Gender Gap Summary Table using Survey Package
print("=== GENDER GAP SUMMARY TABLE ===")

# Calculate survey-weighted means for social conservatism
social_means_survey <- svyby(
  ~social_conservatism,
  ~age + gender,
  design = survey_design,
  FUN = svymean,
  na.rm = TRUE
) %>%
  as.data.frame() %>%
  select(age, gender, social_conservatism) %>%
  pivot_wider(names_from = gender, values_from = social_conservatism, names_prefix = "social_") %>%
  mutate(social_gap = social_male - social_female)

# Calculate survey-weighted means for economic leftism  
economic_means_survey <- svyby(
  ~economic_leftism,
  ~age + gender,
  design = survey_design,
  FUN = svymean,
  na.rm = TRUE
) %>%
  as.data.frame() %>%
  select(age, gender, economic_leftism) %>%
  pivot_wider(names_from = gender, values_from = economic_leftism, names_prefix = "economic_") %>%
  mutate(economic_gap = economic_male - economic_female)

# Statistical significance tests for each age group
age_groups <- unique(uk_data$age[!is.na(uk_data$age)])

# Function to perform survey-weighted t-tests
perform_survey_ttest <- function(age_group, variable) {
  # Filter data for this age group
  age_subset <- uk_data %>% 
    filter(age == age_group, !is.na(!!sym(variable)), !is.na(gender))
  
  if(nrow(age_subset) < 10) return(list(p_value = NA, t_stat = NA))
  
  # Create survey design for this subset
  design_subset <- svydesign(
    ids = ~1,
    weights = ~wt,
    data = age_subset
  )
  
  # Perform t-test comparing male vs female
  tryCatch({
    test_result <- svyttest(as.formula(paste(variable, "~ gender")), design_subset)
    list(p_value = test_result$p.value, t_stat = test_result$statistic)
  }, error = function(e) {
    list(p_value = NA, t_stat = NA)
  })
}

# Calculate significance tests for all age groups
significance_results <- map_dfr(age_groups, function(age_gr) {
  social_test <- perform_survey_ttest(age_gr, "social_conservatism")
  economic_test <- perform_survey_ttest(age_gr, "economic_leftism")
  
  tibble(
    age = age_gr,
    social_p_value = social_test$p_value,
    social_t_stat = social_test$t_stat,
    economic_p_value = economic_test$p_value,
    economic_t_stat = economic_test$t_stat
  )
})

# Combine into final summary table with significance tests
gender_gap_summary <- social_means_survey %>%
  left_join(economic_means_survey, by = "age") %>%
  left_join(significance_results, by = "age") %>%
  mutate(
    social_gap = round(social_gap, 3),
    economic_gap = round(economic_gap, 3),
    social_p_value = round(social_p_value, 4),
    economic_p_value = round(economic_p_value, 4),
    social_significant = case_when(
      is.na(social_p_value) ~ "N/A",
      social_p_value < 0.001 ~ "***",
      social_p_value < 0.01 ~ "**", 
      social_p_value < 0.05 ~ "*",
      social_p_value < 0.1 ~ ".",
      TRUE ~ ""
    ),
    economic_significant = case_when(
      is.na(economic_p_value) ~ "N/A",
      economic_p_value < 0.001 ~ "***",
      economic_p_value < 0.01 ~ "**",
      economic_p_value < 0.05 ~ "*", 
      economic_p_value < 0.1 ~ ".",
      TRUE ~ ""
    )
  ) %>%
  select(age, social_gap, social_p_value, social_significant, 
         economic_gap, economic_p_value, economic_significant) %>%
  arrange(age)

print(gender_gap_summary)
cat("\nSignificance codes: *** p<0.001, ** p<0.01, * p<0.05, . p<0.1\n")
```

In the above, **a positive gap indicates that males score higher than females on that dimension**.

The exists gap amongst younger age groups is statistically significant. It exits for both genders. Young men are more socially conservative than young women. Young men are also more economically right wing than young women. The gap narrows with age.

Now we'll drill down into more specific issue areas. These can inform PR, targeting and communication strategy for the FTSE company.

##### Specific issue divergence by gender and age groups

```{r}
# Individual Question Gender Gap Analysis - Overall Rankings
print("=== INDIVIDUAL QUESTION GENDER GAPS (OVERALL) ===")

# Define all individual attitude questions with descriptions
attitude_questions <- list(
  "soc_respect" = "Young people don't have enough respect for traditional British values",
  "soc_deathpen" = "Death penalty is most appropriate for some crimes", 
  "soc_schools" = "Schools should teach children to obey authority",
  "soc_censor" = "Censorship necessary to uphold moral standards",
  "soc_punish" = "Law breakers should get stiffer sentences",
  "econ_redist" = "Government should redistribute from better off to less well off",
  "econ_bigbiz" = "Big business take advantage of ordinary people",
  "econ_unfair" = "Ordinary people do not get fair share of nation's wealth", 
  "econ_onelaw" = "One law for rich, another for poor",
  "econ_exploit" = "Management will always try to get better of employees"
)

# Calculate overall gender gaps for each individual question with significance tests
individual_gaps_overall <- map_dfr(names(attitude_questions), function(var) {
  # Filter data for this question
  question_data <- uk_data %>% filter(!is.na(!!sym(var)), !is.na(gender))
  
  # Create survey design
  design_question <- svydesign(ids = ~1, weights = ~wt, data = question_data)
  
  # Calculate survey-weighted means by gender
  means_by_gender <- svyby(
    as.formula(paste("~", var)),
    ~gender,
    design = design_question,
    FUN = svymean,
    na.rm = TRUE
  ) %>%
    as.data.frame()
  
  # Perform survey-weighted t-test
  tryCatch({
    ttest_result <- svyttest(as.formula(paste(var, "~ gender")), design_question)
    p_value <- ttest_result$p.value
    t_stat <- ttest_result$statistic
  }, error = function(e) {
    p_value <- NA
    t_stat <- NA
  })
  
  # Extract male and female means
  male_mean <- means_by_gender[means_by_gender$gender == "male", var]
  female_mean <- means_by_gender[means_by_gender$gender == "female", var]
  
  # Calculate gap and significance
  gender_gap <- male_mean - female_mean
  significance <- case_when(
    is.na(p_value) ~ "N/A",
    p_value < 0.001 ~ "***",
    p_value < 0.01 ~ "**",
    p_value < 0.05 ~ "*",
    p_value < 0.1 ~ ".",
    TRUE ~ ""
  )
  
  # Create result
  tibble(
    question = var,
    description = attitude_questions[[var]],
    male_mean = round(male_mean, 3),
    female_mean = round(female_mean, 3),
    gender_gap = round(gender_gap, 3),
    p_value = round(p_value, 4),
    significance = significance,
    gap_magnitude = abs(gender_gap)
  )
}) %>%
  arrange(desc(gap_magnitude))

print(individual_gaps_overall)
cat("\nSignificance codes: *** p<0.001, ** p<0.01, * p<0.05, . p<0.1\n")
```

If we examine gender gaps across all ages, some notable trends emerge.

Censorship observed as the strongest point of disagreement, with women being 0.127 points higher on the agreement scale on average. Followed by the death penalty, where men are 0.069 points higher on the agreement scale.

Areas of issue agreement skew towards economic issues, such as government redistribution and predatory big business perceptions. Notably, stances on stiffer punishment sentences are fairly similar across genders.

```{r}
# Age-Stratified Individual Question Analysis
print("=== INDIVIDUAL QUESTION GENDER GAPS BY AGE GROUP ===")

# Calculate gender gaps for each question within each age group with significance tests
individual_gaps_by_age <- map_dfr(names(attitude_questions), function(var) {
  # Get unique age groups
  age_groups <- unique(uk_data$age[!is.na(uk_data$age)])
  
  # Calculate for each age group
  map_dfr(age_groups, function(age_gr) {
    # Filter data for this age group and question
    age_data <- uk_data %>% 
      filter(age == age_gr, !is.na(!!sym(var)), !is.na(gender))
    
    if(nrow(age_data) < 20) {
      return(tibble(
        question = var,
        age = age_gr, 
        male_mean = NA,
        female_mean = NA,
        gender_gap = NA,
        p_value = NA,
        significance = "N/A"
      ))
    }
    
    # Create survey design for this subset
    design_subset <- svydesign(ids = ~1, weights = ~wt, data = age_data)
    
    # Calculate means by gender
    means_by_gender <- svyby(
      as.formula(paste("~", var)),
      ~gender,
      design = design_subset,
      FUN = svymean,
      na.rm = TRUE
    ) %>%
      as.data.frame()
    
    # Perform survey-weighted t-test
    tryCatch({
      ttest_result <- svyttest(as.formula(paste(var, "~ gender")), design_subset)
      p_value <- ttest_result$p.value
    }, error = function(e) {
      p_value <- NA
    })
    
    # Extract means and calculate gap
    male_mean <- means_by_gender[means_by_gender$gender == "male", var]
    female_mean <- means_by_gender[means_by_gender$gender == "female", var]
    gender_gap <- male_mean - female_mean
    
    # Calculate significance
    significance <- case_when(
      is.na(p_value) ~ "N/A",
      p_value < 0.001 ~ "***",
      p_value < 0.01 ~ "**",
      p_value < 0.05 ~ "*",
      p_value < 0.1 ~ ".",
      TRUE ~ ""
    )
    
    tibble(
      question = var,
      age = age_gr,
      male_mean = round(male_mean, 3),
      female_mean = round(female_mean, 3), 
      gender_gap = round(gender_gap, 3),
      p_value = round(p_value, 4),
      significance = significance
    )
  })
})

# Create wide format tables with significance information
gaps_wide <- individual_gaps_by_age %>%
  left_join(
    tibble(question = names(attitude_questions), 
           description = unlist(attitude_questions)), 
    by = "question"
  ) %>%
  select(question, description, age, gender_gap, significance) %>%
  mutate(gap_with_sig = paste0(round(gender_gap, 3), significance)) %>%
  select(-gender_gap, -significance) %>%
  pivot_wider(names_from = age, values_from = gap_with_sig, names_prefix = "gap_") %>%
  arrange(question)

print(gaps_wide)

# Show detailed results with significance for largest gaps by age group
print("\n=== LARGEST GENDER GAPS BY AGE GROUP (with significance) ===")
largest_gaps_by_age <- individual_gaps_by_age %>%
  filter(!is.na(gender_gap)) %>%
  group_by(age) %>%
  slice_max(abs(gender_gap), n = 4) %>%
  left_join(
    tibble(question = names(attitude_questions), 
           description = unlist(attitude_questions)), 
    by = "question"
  ) %>%
  select(age, question, description, gender_gap, p_value, significance) %>%
  arrange(age, desc(abs(gender_gap)))

print(largest_gaps_by_age)

# Summary of significant gaps by age group
print("\n=== SIGNIFICANT GAPS SUMMARY BY AGE GROUP ===")
significant_gaps_summary <- individual_gaps_by_age %>%
  filter(!is.na(p_value), p_value < 0.05) %>%
  group_by(age) %>%
  summarise(
    n_significant = n(),
    avg_significant_gap = round(mean(abs(gender_gap)), 3),
    largest_gap = round(max(abs(gender_gap)), 3),
    .groups = "drop"
  ) %>%
  arrange(desc(n_significant))

print(significant_gaps_summary)
cat("\nSignificance codes: *** p<0.001, ** p<0.01, * p<0.05, . p<0.1\n")
```

After segmenting by age and accounting for statistical significance, young people diverge in terms of specific issues.

We also see that the average gap between genders declines with age, with the specific issue gaps shrinking towards middle age, and then increasing in old age.

Add visualizations for specific issue areas down the line. Good to know these differences. 

#### 4) Modelling stage - how does age, gender, other demographics predict ideology?

**Is the gender-age interaction the primary driver of ideological differences, or do other demographics matter more?** Informs whether the CEO should focus messaging strategies on generational gender gaps vs. other demographic segments.

```{r}
# Create survey design object

# Note that we could add stratification to this stage, such as though religion or age. We don't know the stratification scheme. 
survey_design_full <- svydesign(
  ids = ~1,  # No clustering in this dataset, assumes simple random sampling
  weights = ~wt,
  data = uk_data
)
```

##### M1: Social Conservatism Predictors

What demographic factors best predict social conservatism? Is the gender-age interaction significant even after controlling for education, region, etc.?

```{r}
# Model social conservatism with full demographic controls
model_social <- svyglm(
  social_conservatism ~ gender * age + gender * education + age * education + 
                       gender * region + ethnicity + household + socgrad + 
                       marital + religion,
  design = survey_design_full,
  family = gaussian()
)

# Display model summary
summary(model_social)

# Extract key coefficients for interpretation
social_coefs <- summary(model_social)$coefficients

# Model fit statistics
cat("\nModel Fit Statistics:\n")
cat("Degrees of Freedom:", model_social$df.residual, "\n")
cat("Deviance:", round(model_social$deviance, 3), "\n")

##  Check further diagnostics if wanted
#plot(model_social)

##  VIF Multicollinearity
library(car)
car::vif(model_social, type = 'terms')  # Check for multicollinearity

# Number of observations
nobs(model_social)  # Number of observations

```

Reference categories: 

Above shows similar trends to what we've been seeing and hypothesizing.

The main effect shows males are more conservative (+0.040), but the interactions reveal this gender gap narrows with age. In middle age (45-64), the male effect is actually reduced by about 0.067-0.088, suggesting older women catch up in conservatism.

- **Gender gap widens with age**: Young women (18-24) and young men show minimal difference, but the gap grows significantly in middle age groups (45-54, 55-64), with men becoming substantially more conservative than women as they age

- **Education creates opposite patterns by gender**: The gender gap is smaller among highly educated groups - educated men are less conservative relative to educated women, while among non-degree holders, men are significantly more conservative than women

- **London and Scotland stand out**: Both regions show significantly lower social conservatism overall, with London showing a 0.052 point decrease and Scotland showing a 0.065 point decrease compared to the reference region

- **Religious affiliation is the strongest predictor**: People with no religious affiliation are dramatically less socially conservative (-0.152 points), representing the largest single effect in the model, while Hindu respondents show higher conservatism

- **Social class matters more than individual demographics**: Working class groups (C2, DE) show significantly higher social conservatism, and this effect is larger than most individual demographic characteristics, suggesting economic position shapes social attitudes.

Note the reference categories in interpreting the above. 

##### M2: Economic Leftism Predictors

Are the drivers of economic vs social attitudes different? This matters for corporate positioning on economic vs social issues.


```{r}
# Model economic leftism with same demographic controls
model_economic <- svyglm(
  economic_leftism ~ gender * age + gender * education + age * education + 
                       gender * region + ethnicity + household + socgrad + 
                       marital + religion,
  design = survey_design_full,
  family = gaussian()
)

# Display model summary
summary(model_economic)

# Extract key coefficients for interpretation
economic_coefs <- summary(model_economic)$coefficients

# Model fit statistics
cat("\nModel Fit Statistics:\n")
cat("Degrees of Freedom:", model_economic$df.residual, "\n")
cat("Deviance:", round(model_economic$deviance, 3), "\n")

##  Check further diagnostics if wanted
#plot(model_economic)

##  VIF Multicollinearity
library(car)
car::vif(model_economic, type = 'terms')  # Check for multicollinearity

# Number of observations
nobs(model_economic)  # Number of observations

```

similar trends as seen from our prior visuals and analysis.

Interpreting the economic leftism model:

- **Strong gender divide that increases with age**: Young women (18-24) are more economically left-wing than men, and this gap dramatically widens with age - by 65-74, men are about 0.11 points more left-wing than the baseline, creating a substantial gender gap favoring women's left-wing positions

- **Education reverses the gender pattern**: Among highly educated people, women are more left-wing than men, but among those without degrees, men actually become slightly more economically left-wing than women (interaction effect of +0.026)

- **Regional variations in gender gaps**: The economic gender divide is most pronounced in South East England and North West England, where men show significantly higher left-wing tendencies relative to women compared to other regions

- **Housing tenure is the strongest economic predictor**: Social renters show the highest economic leftism (+0.121), followed by private renters (+0.082), suggesting housing insecurity drives left-wing economic attitudes more than traditional demographic factors

- **Class and economic leftism align strongly**: Working class groups (C2, DE) are significantly more economically left-wing, with DE showing the largest effect (+0.101), indicating clear class-based economic attitudes that transcend gender and age divisions

Overall, housing is a more important driver in economic leftism than social conservatism.

Some classic political archetypes/clustering in the data, as expected.

##### M3: Vote Choice Prediction

Do ideological attitudes predict vote better than demographics alone? This tests whether corporate positioning should focus on values vs identity.

```{r}
# Conservative vote model
model_vote_con <- svyglm(
  I(pv_2024 == "con") ~ gender * age + gender * education + age * education + 
                       gender * region + ethnicity + household + socgrad + 
                       marital + religion,
  design = survey_design_full,
  family = binomial(link = "logit")
)
summary(model_vote_con)

# Labour vote model
model_vote_lab <- svyglm(
  I(pv_2024 == "lab") ~ gender * age + gender * education + age * education + 
                       gender * region + ethnicity + household + socgrad + 
                       marital + religion,
  design = survey_design_full,
  family = binomial(link = "logit")
)
summary(model_vote_lab)

# Reform vote model
model_vote_rfm <- svyglm(
  I(pv_2024 == "rfm") ~ gender * age + gender * education + age * education + 
                       gender * region + ethnicity + household + socgrad + 
                       marital + religion,
  design = survey_design_full,
  family = binomial(link = "logit")
)
summary(model_vote_rfm)

# Green vote model
model_vote_grn <- svyglm(
  I(pv_2024 == "grn") ~ gender * age + gender * education + age * education + 
                       gender * region + ethnicity + household + socgrad + 
                       marital + religion,
  design = survey_design_full,
  family = binomial(link = "logit")
)
summary(model_vote_grn)

# Liberal Democrat vote model
model_vote_ldm <- svyglm(
  I(pv_2024 == "ldm") ~ gender * age + gender * education + age * education + 
                       gender * region + ethnicity + household + socgrad + 
                       marital + religion,
  design = survey_design_full,
  family = binomial(link = "logit")
)
summary(model_vote_ldm)

```


##### Checking Model Robustness

Important to check the goodness of fit of our models. If our models are good, then we can use them for continual segmented analysis and answer some pertinent business questions around specific audiences/ market areas. 


Examining residuals vs. fitted values for each model:
```{r}
# Residuals vs Fitted for Social Conservatism Model
res <- residuals(model_social, type = "response")
fit <- fitted(model_social)

plot(fit, res,
     xlab = "Fitted values",
     ylab = "Residuals",
     main = "Residuals vs Fitted")
abline(h = 0, col = "red")

# Distribution of residuals
hist(res, breaks = 30, main = "Histogram of residuals")
qqnorm(res); qqline(res, col = "red")

# Check fitted value range 
range(fit)
mean(fit < -1 | fit > 1)

# Pseudo R-squared
y <- model_social$y
r2 <- 1 - sum(res^2) / sum((y - mean(y))^2)
r2

```

Note that clustering of residuals vs. fitted show diagonal banding, but is likely that this comes predictors being mostly categorical, so fitted values clsuter at a few discrete points. No major heteroskasticity. 

Predictions stay within the valid DV range. Normal that they shrink a bit from the extremes. 

Residuals look roughly normal and centered, though tails deviate a bit.

R² ≈ 0.12: moderate explanatory power for this kind of attitudinal outcome in our social science context.

We would expect to see similar for the economic leftism model. Let's see

```{r}
# Residuals vs Fitted for Economic Leftism Model
res <- residuals(model_economic, type = "response")

fit <- fitted(model_economic)

plot(fit, res,
     xlab = "Fitted values",
     ylab = "Residuals",
     main = "Residuals vs Fitted")
abline(h = 0, col = "red")

# Distribution of residuals
hist(res, breaks = 30, main = "Histogram of residuals")
qqnorm(res); qqline(res, col = "red")

# Check fitted value range 
range(fit)
mean(fit < -1 | fit > 1)

# Pseudo R-squared
y <- model_economic$y
r2 <- 1 - sum(res^2) / sum((y - mean(y))^2)
r2


```
R-squared lower at 6% than with the social conservatism model, but still reasonable for this kind of attitudinal outcome.

We can say that social conservatism is more demographically/ sociologically structured in our sample than economic leftism, owing to this lower R-squared. 

#### 5) Segmented Modelling - Young vs Older Age Bands with Interaction Effects

**Are young people truly different, or just experiencing new intersection age + gender effects? How do our other predictors work differently for this cohort of respondents?**

Using interaction modeling approach to maintain survey weight validity while testing age differences in gender effects.

##### Create Age Group Variable and Interaction Models

```{r}
# Create age group variable for interaction analysis
modeling_data_interaction <- uk_data %>%
  mutate(
    age_group = case_when(
      age %in% c("18_TO_24", "25_TO_34") ~ "young",
      age %in% c("35_TO_44", "45_TO_54", "55_TO_64", "65_TO_74", "75_PLUS") ~ "older"
    )
  ) %>%
  filter(!is.na(age_group))

print(paste("Sample size for interaction analysis:", nrow(modeling_data_interaction)))

# Create survey design for interaction analysis
survey_design_interaction <- svydesign(
  ids = ~1,
  weights = ~wt,
  data = modeling_data_interaction
)

# Social conservatism model with gender*age_group interaction
model_social_interaction <- svyglm(
  social_conservatism ~ gender * age_group + education + ethnicity + region + 
                       household + socgrad + marital + religion,
  design = survey_design_interaction
)

summary(model_social_interaction)

# Economic leftism model with gender*age_group interaction
model_economic_interaction <- svyglm(
  economic_leftism ~ gender * age_group + education + ethnicity + region + 
                    household + socgrad + marital + religion,
  design = survey_design_interaction
)

summary(model_economic_interaction)
```

Social Conservatism - Gender x Age Interaction:
Coefficient: 0.044 
p-value: 0 
Interpretation: Difference in male effect between young vs older

Economic Leftism - Gender x Age Interaction:
Coefficient: -0.051 
p-value: 0 
Interpretation: Difference in male effect between young vs older


The relative effect is marginal between young and old. Not that important for our takeaway results. We already know that gender effects differ by age, so this proves it statistically. 

#### 6) Presentation generation, visuals etc.

Come back to this at a later stage. Enough results for now to move onto the function generation. We'll do this step in a separate document.


#### 7) Extended Segment Analysis - Intersectionality

**What specifically is driving the change to the right-wing amongst younger men? Is the ongoing shift about women moving more left, or is it also about men moving more right**

**Can we find evidence for the claims posited in the article on this issue? Those made by Alice Evans?**

##### Vote Switching: Left-to-Right Shifters 2019-2024

```{r}
# Identify vote switchers from left-wing to right-wing parties
# Define party classifications
left_parties <- c("lab", "grn", "ldm")  # Labour, Green, Lib Dem
right_parties <- c("con", "rfm")        # Conservative, Reform

# Create switching analysis dataset
vote_switchers <- uk_data %>%
  filter(!is.na(pv_2019) & !is.na(pv_2024)) %>%
  mutate(
    voted_left_2019 = pv_2019 %in% left_parties,
    voted_right_2024 = pv_2024 %in% right_parties,
    left_to_right_switch = voted_left_2019 & voted_right_2024
  )

# Summary of switching patterns
cat("=== VOTE SWITCHING SUMMARY ===\n")
switching_summary <- vote_switchers %>%
  group_by(voted_left_2019, voted_right_2024) %>%
  summarise(
    count = n(),
    weighted_count = sum(wt, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(percentage = round(weighted_count / sum(weighted_count) * 100, 1))

print(switching_summary)

# Focus on left-to-right switchers
left_to_right_switchers <- vote_switchers %>%
  filter(left_to_right_switch == TRUE)

cat("\nTotal left-to-right switchers:", nrow(left_to_right_switchers))
cat("\nWeighted count:", round(sum(left_to_right_switchers$wt, na.rm = TRUE)))

# Demographics of left-to-right switchers vs non-switchers
cat("\n=== DEMOGRAPHICS OF LEFT-TO-RIGHT SWITCHERS ===\n")

# Gender breakdown
gender_switching <- vote_switchers %>%
  group_by(gender, left_to_right_switch) %>%
  summarise(
    weighted_count = sum(wt, na.rm = TRUE),
    .groups = "keep"
  ) %>%
  group_by(gender) %>%
  mutate(
    total = sum(weighted_count),
    switch_rate = round(weighted_count[left_to_right_switch == TRUE] / total * 100, 1)
  ) %>%
  filter(left_to_right_switch == TRUE) %>%
  select(gender, switch_rate)

print("Left-to-right switching rates by gender:")
print(gender_switching)

# Age breakdown
age_switching <- vote_switchers %>%
  group_by(age, left_to_right_switch) %>%
  summarise(
    weighted_count = sum(wt, na.rm = TRUE),
    .groups = "keep"
  ) %>%
  group_by(age) %>%
  mutate(
    total = sum(weighted_count),
    switch_rate = round(weighted_count[left_to_right_switch == TRUE] / total * 100, 1)
  ) %>%
  filter(left_to_right_switch == TRUE) %>%
  select(age, switch_rate) %>%
  arrange(desc(switch_rate))

print("\nLeft-to-right switching rates by age:")
print(age_switching)

# Education breakdown
education_switching <- vote_switchers %>%
  filter(!is.na(education)) %>%
  group_by(education, left_to_right_switch) %>%
  summarise(
    weighted_count = sum(wt, na.rm = TRUE),
    .groups = "keep"
  ) %>%
  group_by(education) %>%
  mutate(
    total = sum(weighted_count),
    switch_rate = round(weighted_count[left_to_right_switch == TRUE] / total * 100, 1)
  ) %>%
  filter(left_to_right_switch == TRUE) %>%
  select(education, switch_rate)

print("\nLeft-to-right switching rates by education:")
print(education_switching)

# Predictive model for left-to-right switching
switching_model <- vote_switchers %>%
  filter(!is.na(gender) & !is.na(age) & !is.na(education) & !is.na(ethnicity))

# Create survey design for switching analysis
survey_design_switching <- svydesign(
  ids = ~1,
  weights = ~wt,
  data = switching_model
)

# Logistic regression predicting left-to-right switching
switch_prediction_model <- svyglm(
  left_to_right_switch ~ gender * age + gender * education + age * education + 
                       gender * region + ethnicity + household + socgrad + 
                       marital + religion,
  design = survey_design_switching,
  family = binomial(link = "logit")
)

summary(switch_prediction_model)

nobs(switch_prediction_model)
```

Switch rate represents the percentage of that group which switched from left to right in terms of party vote.

Being aged 25 to 34 is positively associated with switching from left to right in terms of party vote. Further analysis can be done on this and on the specific points, if it's deemed necessary down the line.

##### Vote Switching: Right-to-Left Shifters 2019-2024

```{r}
# Identify vote switchers from right-wing to left-wing parties
# Using same party classifications as above
# left_parties <- c("lab", "grn", "ldm")  # Labour, Green, Lib Dem
# right_parties <- c("con", "rfm")        # Conservative, Reform

# Create right-to-left switching analysis dataset
vote_switchers_rtl <- uk_data %>%
  filter(!is.na(pv_2019) & !is.na(pv_2024)) %>%
  mutate(
    voted_right_2019 = pv_2019 %in% right_parties,
    voted_left_2024 = pv_2024 %in% left_parties,
    right_to_left_switch = voted_right_2019 & voted_left_2024
  )

# Summary of right-to-left switching patterns
cat("=== RIGHT-TO-LEFT VOTE SWITCHING SUMMARY ===\n")
switching_summary_rtl <- vote_switchers_rtl %>%
  group_by(voted_right_2019, voted_left_2024) %>%
  summarise(
    count = n(),
    weighted_count = sum(wt, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(percentage = round(weighted_count / sum(weighted_count) * 100, 1))

print(switching_summary_rtl)

# Focus on right-to-left switchers
right_to_left_switchers <- vote_switchers_rtl %>%
  filter(right_to_left_switch == TRUE)

cat("\nTotal right-to-left switchers:", nrow(right_to_left_switchers))
cat("\nWeighted count:", round(sum(right_to_left_switchers$wt, na.rm = TRUE)))

# Demographics of right-to-left switchers vs non-switchers
cat("\n=== DEMOGRAPHICS OF RIGHT-TO-LEFT SWITCHERS ===\n")

# Gender breakdown
gender_switching_rtl <- vote_switchers_rtl %>%
  group_by(gender, right_to_left_switch) %>%
  summarise(
    weighted_count = sum(wt, na.rm = TRUE),
    .groups = "keep"
  ) %>%
  group_by(gender) %>%
  mutate(
    total = sum(weighted_count),
    switch_rate = round(weighted_count[right_to_left_switch == TRUE] / total * 100, 1)
  ) %>%
  filter(right_to_left_switch == TRUE) %>%
  select(gender, switch_rate)

print("Right-to-left switching rates by gender:")
print(gender_switching_rtl)

# Age breakdown
age_switching_rtl <- vote_switchers_rtl %>%
  group_by(age, right_to_left_switch) %>%
  summarise(
    weighted_count = sum(wt, na.rm = TRUE),
    .groups = "keep"
  ) %>%
  group_by(age) %>%
  mutate(
    total = sum(weighted_count),
    switch_rate = round(weighted_count[right_to_left_switch == TRUE] / total * 100, 1)
  ) %>%
  filter(right_to_left_switch == TRUE) %>%
  select(age, switch_rate) %>%
  arrange(desc(switch_rate))

print("\nRight-to-left switching rates by age:")
print(age_switching_rtl)

# Education breakdown
education_switching_rtl <- vote_switchers_rtl %>%
  filter(!is.na(education)) %>%
  group_by(education, right_to_left_switch) %>%
  summarise(
    weighted_count = sum(wt, na.rm = TRUE),
    .groups = "keep"
  ) %>%
  group_by(education) %>%
  mutate(
    total = sum(weighted_count),
    switch_rate = round(weighted_count[right_to_left_switch == TRUE] / total * 100, 1)
  ) %>%
  filter(right_to_left_switch == TRUE) %>%
  select(education, switch_rate)

print("\nRight-to-left switching rates by education:")
print(education_switching_rtl)

# Predictive model for right-to-left switching
switching_model_rtl <- vote_switchers_rtl %>%
  filter(!is.na(gender) & !is.na(age) & !is.na(education) & !is.na(ethnicity))

# Create survey design for right-to-left switching analysis
survey_design_switching_rtl <- svydesign(
  ids = ~1,
  weights = ~wt,
  data = switching_model_rtl
)

# Logistic regression predicting right-to-left switching
switch_prediction_model_rtl <- svyglm(
  right_to_left_switch ~ gender * age + gender * education + age * education + 
                       gender * region + ethnicity + household + socgrad + 
                       marital + religion,
  design = survey_design_switching_rtl,
  family = binomial(link = "logit")
)

summary(switch_prediction_model_rtl)

nobs(switch_prediction_model_rtl)
```

Switch rate represents the percentage of that group which switched from right to left in terms of party vote.

Having verified the goodness of fit of our earlier OLS predictive models, I feel confident in basing segmented analysis results on these. They'll be utilized to generate predicted values.

##### Geographic: London vs. non-London 

Is the gender divide smaller/different in London vs. rest of the UK?
Run a model for London vs. Manchester vs. rural constituencies


Do economic leftism gender gaps vary by region's economic health?
Comparing wealthy south east vs. post industrial north

```{r}
# Gender gap analysis by region and age group (using weighted means)
gender_gap_by_region_age <- uk_data %>%
  filter(!is.na(social_conservatism), !is.na(economic_leftism), !is.na(gender), !is.na(region), !is.na(age), !is.na(wt)) %>%
  group_by(region, age, gender) %>%
  summarise(
    avg_social = weighted.mean(social_conservatism, wt, na.rm = TRUE),
    avg_economic = weighted.mean(economic_leftism, wt, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) %>%
  pivot_wider(names_from = gender, values_from = c(avg_social, avg_economic, n), names_sep = "_") %>%
  filter(!is.na(avg_social_male), !is.na(avg_social_female), 
         !is.na(avg_economic_male), !is.na(avg_economic_female)) %>%
  mutate(
    social_gap = avg_social_male - avg_social_female,
    economic_gap = avg_economic_male - avg_economic_female
  ) %>%
  select(region, age, social_gap, economic_gap, n_male, n_female) %>%
  arrange(region, age)

print("Gender gaps by region and age group (male - female):")
print(gender_gap_by_region_age)

# Create London vs Rest of UK comparison
london_vs_rest <- gender_gap_by_region_age %>%
  mutate(
    location = ifelse(region == "Greater London", "London", "Rest of UK")
  ) %>%
  group_by(location, age) %>%
  summarise(
    social_gap = weighted.mean(social_gap, n_male + n_female, na.rm = TRUE),
    economic_gap = weighted.mean(economic_gap, n_male + n_female, na.rm = TRUE),
    total_n = sum(n_male + n_female, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_longer(cols = c(social_gap, economic_gap), 
               names_to = "gap_type", 
               values_to = "gap_value") %>%
  mutate(
    gap_type = case_when(
      gap_type == "social_gap" ~ "Social Conservatism Gap",
      gap_type == "economic_gap" ~ "Economic Leftism Gap"
    )
  )

# Create line plot to show trends more clearly
library(ggplot2)
ggplot(london_vs_rest, aes(x = age, y = gap_value, color = location, group = location)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
  facet_wrap(~gap_type, scales = "free_y") +
  labs(
    title = "Gender Ideological Gaps: London vs Rest of UK",
    subtitle = "How gender divides vary by age and location",
    x = "Age Group", 
    y = "Gender Gap (Male - Female)",
    color = "Location",
    caption = "Positive = men more conservative/economically left than women"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(size = 14, face = "bold"),
    strip.text = element_text(size = 12, face = "bold")
  ) +
  scale_color_manual(values = c("London" = "#E74C3C", "Rest of UK" = "#3498DB"))
```

##### Education and Age Group Mean Difference

```{r}
# Gender gap analysis by education and age group (using weighted means)
gender_gap_by_education_age <- uk_data %>%
  filter(!is.na(social_conservatism), !is.na(economic_leftism), !is.na(gender), !is.na(education), !is.na(age), !is.na(wt)) %>%
  group_by(education, age, gender) %>%
  summarise(
    avg_social = weighted.mean(social_conservatism, wt, na.rm = TRUE),
    avg_economic = weighted.mean(economic_leftism, wt, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) %>%
  pivot_wider(names_from = gender, values_from = c(avg_social, avg_economic, n), names_sep = "_") %>%
  filter(!is.na(avg_social_male), !is.na(avg_social_female), 
         !is.na(avg_economic_male), !is.na(avg_economic_female)) %>%
  mutate(
    social_gap = avg_social_male - avg_social_female,
    economic_gap = avg_economic_male - avg_economic_female
  ) %>%
  select(education, age, social_gap, economic_gap, n_male, n_female) %>%
  arrange(education, age)

print("Gender gaps by education and age group (male - female):")
print(gender_gap_by_education_age)

# Check education levels
cat("Available education levels:\n")
print(unique(gender_gap_by_education_age$education))

# Create education comparison for visualization
education_comparison <- gender_gap_by_education_age %>%
  pivot_longer(cols = c(social_gap, economic_gap), 
               names_to = "gap_type", 
               values_to = "gap_value") %>%
  mutate(
    gap_type = case_when(
      gap_type == "social_gap" ~ "Social Conservatism Gap",
      gap_type == "economic_gap" ~ "Economic Leftism Gap"
    )
  )

# Create line plot for education gaps
ggplot(education_comparison, aes(x = age, y = gap_value, color = education, group = education)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
  facet_wrap(~gap_type, scales = "free_y") +
  labs(
    title = "Gender Ideological Gaps by Education Level",
    subtitle = "How gender divides vary by age and education",
    x = "Age Group", 
    y = "Gender Gap (Male - Female)",
    color = "Education",
    caption = "Positive = men more conservative/economically left than women"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(size = 14, face = "bold"),
    strip.text = element_text(size = 12, face = "bold")
  ) +
  scale_color_brewer(type = "qual", palette = "Set1")
```

##### Social Grade and Age Group Mean Difference

```{r}
# Gender gap analysis by social grade and age group (using weighted means)
gender_gap_by_socgrad_age <- uk_data %>%
  filter(!is.na(social_conservatism), !is.na(economic_leftism), !is.na(gender), !is.na(socgrad), !is.na(age), !is.na(wt)) %>%
  group_by(socgrad, age, gender) %>%
  summarise(
    avg_social = weighted.mean(social_conservatism, wt, na.rm = TRUE),
    avg_economic = weighted.mean(economic_leftism, wt, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) %>%
  pivot_wider(names_from = gender, values_from = c(avg_social, avg_economic, n), names_sep = "_") %>%
  filter(!is.na(avg_social_male), !is.na(avg_social_female), 
         !is.na(avg_economic_male), !is.na(avg_economic_female)) %>%
  mutate(
    social_gap = avg_social_male - avg_social_female,
    economic_gap = avg_economic_male - avg_economic_female
  ) %>%
  select(socgrad, age, social_gap, economic_gap, n_male, n_female) %>%
  arrange(socgrad, age)

print("Gender gaps by social grade and age group (male - female):")
print(gender_gap_by_socgrad_age)

# Check social grade levels
cat("Available social grade levels:\n")
print(unique(gender_gap_by_socgrad_age$socgrad))

# Create social grade comparison for visualization
socgrad_comparison <- gender_gap_by_socgrad_age %>%
  pivot_longer(cols = c(social_gap, economic_gap), 
               names_to = "gap_type", 
               values_to = "gap_value") %>%
  mutate(
    gap_type = case_when(
      gap_type == "social_gap" ~ "Social Conservatism Gap",
      gap_type == "economic_gap" ~ "Economic Leftism Gap"
    )
  )

# Create line plot for social grade gaps
ggplot(socgrad_comparison, aes(x = age, y = gap_value, color = socgrad, group = socgrad)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
  facet_wrap(~gap_type, scales = "free_y") +
  labs(
    title = "Gender Ideological Gaps by Social Grade",
    subtitle = "How gender divides vary by age and social class (AB=highest, DE=lowest)",
    x = "Age Group", 
    y = "Gender Gap (Male - Female)",
    color = "Social Grade",
    caption = "Positive = men more conservative/economically left than women"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(size = 14, face = "bold"),
    strip.text = element_text(size = 12, face = "bold")
  ) +
  scale_color_manual(values = c("AB" = "#8E44AD", "C1" = "#3498DB", "C2" = "#E67E22", "DE" = "#E74C3C"))
```

##### Ethnicity and Age Group Mean Difference

```{r}
# Gender gap analysis by ethnicity and age group (using weighted means)
gender_gap_by_ethnicity_age <- uk_data %>%
  filter(!is.na(social_conservatism), !is.na(economic_leftism), !is.na(gender), !is.na(ethnicity), !is.na(age), !is.na(wt)) %>%
  group_by(ethnicity, age, gender) %>%
  summarise(
    avg_social = weighted.mean(social_conservatism, wt, na.rm = TRUE),
    avg_economic = weighted.mean(economic_leftism, wt, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) %>%
  pivot_wider(names_from = gender, values_from = c(avg_social, avg_economic, n), names_sep = "_") %>%
  filter(!is.na(avg_social_male), !is.na(avg_social_female), 
         !is.na(avg_economic_male), !is.na(avg_economic_female)) %>%
  mutate(
    social_gap = avg_social_male - avg_social_female,
    economic_gap = avg_economic_male - avg_economic_female
  ) %>%
  select(ethnicity, age, social_gap, economic_gap, n_male, n_female) %>%
  arrange(ethnicity, age)

print("Gender gaps by ethnicity and age group (male - female):")
print(gender_gap_by_ethnicity_age)

# Check ethnicity levels
cat("Available ethnicity levels:\n")
print(unique(gender_gap_by_ethnicity_age$ethnicity))

# Create ethnicity comparison for visualization
ethnicity_comparison <- gender_gap_by_ethnicity_age %>%
  pivot_longer(cols = c(social_gap, economic_gap), 
               names_to = "gap_type", 
               values_to = "gap_value") %>%
  mutate(
    gap_type = case_when(
      gap_type == "social_gap" ~ "Social Conservatism Gap",
      gap_type == "economic_gap" ~ "Economic Leftism Gap"
    )
  )

# Create line plot for ethnicity gaps
ggplot(ethnicity_comparison, aes(x = age, y = gap_value, color = ethnicity, group = ethnicity)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
  facet_wrap(~gap_type, scales = "free_y") +
  labs(
    title = "Gender Ideological Gaps by Ethnicity",
    subtitle = "How gender divides vary by age and ethnic background",
    x = "Age Group", 
    y = "Gender Gap (Male - Female)",
    color = "Ethnicity",
    caption = "Positive = men more conservative/economically left than women"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(size = 14, face = "bold"),
    strip.text = element_text(size = 12, face = "bold")
  ) +
  scale_color_manual(values = c("white" = "#2C3E50", "asian" = "#E74C3C", "black" = "#F39C12", "mixed" = "#9B59B6", "other" = "#1ABC9C"))
```

##### Religion and Age Group Mean Difference

```{r}
# Gender gap analysis by religion and age group (using weighted means)
gender_gap_by_religion_age <- uk_data %>%
  filter(!is.na(social_conservatism), !is.na(economic_leftism), !is.na(gender), !is.na(religion), !is.na(age), !is.na(wt)) %>%
  group_by(religion, age, gender) %>%
  summarise(
    avg_social = weighted.mean(social_conservatism, wt, na.rm = TRUE),
    avg_economic = weighted.mean(economic_leftism, wt, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) %>%
  pivot_wider(names_from = gender, values_from = c(avg_social, avg_economic, n), names_sep = "_") %>%
  filter(!is.na(avg_social_male), !is.na(avg_social_female), 
         !is.na(avg_economic_male), !is.na(avg_economic_female)) %>%
  mutate(
    social_gap = avg_social_male - avg_social_female,
    economic_gap = avg_economic_male - avg_economic_female
  ) %>%
  select(religion, age, social_gap, economic_gap, n_male, n_female) %>%
  arrange(religion, age)

print("Gender gaps by religion and age group (male - female):")
print(gender_gap_by_religion_age)

# Check religion levels
cat("Available religion levels:\n")
print(unique(gender_gap_by_religion_age$religion))

# Create religion comparison for visualization
religion_comparison <- gender_gap_by_religion_age %>%
  pivot_longer(cols = c(social_gap, economic_gap), 
               names_to = "gap_type", 
               values_to = "gap_value") %>%
  mutate(
    gap_type = case_when(
      gap_type == "social_gap" ~ "Social Conservatism Gap",
      gap_type == "economic_gap" ~ "Economic Leftism Gap"
    )
  )

# Create line plot for religion gaps
ggplot(religion_comparison, aes(x = age, y = gap_value, color = religion, group = religion)) +
  geom_line(size = 1.2) +
  geom_point(size = 3) +
  geom_hline(yintercept = 0, linetype = "dashed", alpha = 0.5) +
  facet_wrap(~gap_type, scales = "free_y") +
  labs(
    title = "Gender Ideological Gaps by Religion",
    subtitle = "How gender divides vary by age and religious affiliation",
    x = "Age Group", 
    y = "Gender Gap (Male - Female)",
    color = "Religion",
    caption = "Positive = men more conservative/economically left than women"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(size = 14, face = "bold"),
    strip.text = element_text(size = 12, face = "bold")
  ) +
  scale_color_manual(values = c("christian" = "#8E44AD", "none" = "#34495E", "muslim" = "#E74C3C", "hindu" = "#F39C12", "other" = "#27AE60", "no_answer" = "#95A5A6"))
```

Some sample size concerns with the above graphics, but gives a good indication of general trends.

##### Further Steps for Research

**Further steps**

Currently thinking to create a polarization index, which measures how far someone is from the mean on both social and economic dimensions. Then we can see who is most polarized, and what predicts this. Not necessary for the current project, an idea for future work.

Likewise, merging in historical data from the British Election Study (BES) would allow us to see how these patterns have changed over time, and whether younger generations are truly more polarized than older ones were at the same age. But not necessary for CEO's immediate priorities.

Additionally, I am considering a more in-depth clustering based analysis of the young person demographic, based on combining issue preferences with demographics like ethnicity, education, and region. This could yield useful archetypes for marketing and communications purposes, but again, could be time-consuming.

- Geographic mapping: urban/rural and constituency-level polarization hotspots
- Polarization intensity metrics: identify most extreme vs moderate young segments
- Attitude clustering: natural groupings and messaging archetypes for corporate strategy
- "Movement" analysis: who is shifting away from older generational patterns most (merging in historical data)
- Issue-specific drivers: which attitudes (social vs economic) drive overall polarization

- Increased usage of the age_numeric variables, more granular analysis of age effects


#### 8) Function generation for future use

Thinking through function generation.





